# 인덱스

## SQL 실행 계획

*   SQL Developer에서 SQL 구문에 F10 키를 누르거나 다음 명령을 실행

```sql
EXPLAIN PLAN FOR SELECT * FROM TB_COMPANY_MASTER; -- 실행 계획 생성
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY); -- 실행 계획 보기
```

*   **`OPTIONS`**: 처리 방법(FULL: 테이블 전체를 스캔)
*   **`CARDINALITY`**: 예상되는 실행 결과 행 수 (실제 결과와 크게 다를 경우 질의가 비효율적)
*   **`COST`**: 예상되는 실행 비용 (비용이 높으면 질의가 비효율적)
*   실제 실행은 역순으로 이뤄짐(하위 실행의 결과가 모여서 상위 실행 결과가 됨)

## 옵티마이저(Optimizer)

*   사용자가 입력한 구문을 최적화해주는 부분
*   **비용 기반 옵티마이저**:
    *   수많은 '후보 실행 계획'을 생성 (예: A->B NL Join, B->A Hash Join...)
    *   통계 정보(`Statistics`) 를 바탕으로 각 계획의 비용(`Cost`) 을 추정
    *   가장 비용이 낮은 계획을 최종 선택

## 옵티마이저 작동 예시

*   서브쿼리

```sql
SELECT * FROM
    (SELECT * FROM TB_COMPANY_MASTER WHERE HQ_ADDRESS LIKE '%강남구%')
WHERE LISTING_DT > '1990-01-01';
```

*   실제로는 `AND` 조건으로 결합해서 한 번에 검색

(실행 계획 예시)
`TABLE ACCESS (FULL)`
`Filter Predicates: AND`
 `HQ_ADDRESS LIKE '%강남구%'`
 `LISTING_DT > '1990-01-01'`

## 인덱스(index)

*   추가적인 쓰기 작업과 저장 공간을 활용하여 데이터베이스 테이블의 검색 속도를 향상시키기 위한 자료구조
*   **장점**
    *   테이블을 조회하는 속도와 그에 따른 성능을 향상시킬 수 있음
    *   전반적인 시스템의 부하를 줄일 수 있음
*   **단점**
    *   인덱스를 관리하기 위해 DB의 저장공간이 필요
    *   데이터 변경 시 인덱스도 변경되어야 하므로 추가 작업이 필요
    *   잘못 사용하면 오히려 성능이 저하
*   인덱스가 있거나 없어도 SQL 문의 실행 결과는 같음(속도만 달라짐)
*   같은 의미면 인덱스를 사용하여 속도를 높일 수 있도록 질의 작성

## 인덱스의 자료 구조

*   **분기(`branch`) 블록**: 검색을 위한 용도
*   **잎(`leaf`) 블록**: 키 값(`rowid`)을 저장

## 인덱스 정보 보기

*   `TB_COMPANY_MASTER`의 인덱스 보기

```sql
SELECT
    INDEX_NAME,    -- 이름
    INDEX_TYPE,    -- 유형
    UNIQUENESS     -- UNIQUE 여부
FROM ALL_INDEXES
WHERE TABLE_NAME = 'TB_COMPANY_MASTER';
```

| INDEX\_NAME | INDEX\_TYPE | UNIQUENESS |
| :--- | :--- | :--- |
| IDX\_COMPANY\_NM | NORMAL | NONUNIQUE |
| IDX\_COMPANY\_EST\_DT | NORMAL | NONUNIQUE |
| IDX\_COMPANY\_COVER\_CAT\_NM | NORMAL | NONUNIQUE |
| IDX\_COMPANY\_CEO\_UPPER | FUNCTION-BASED NORMAL | NONUNIQUE |
| PK\_COMPANY\_MASTER | NORMAL | UNIQUE |
| SYS\_C008505 | NORMAL | UNIQUE |

## 인덱스를 구성하는 컬럼

*   `TB_COMPANY_MASTER`의 인덱스를 구성하는 컬럼 보기

```sql
SELECT
    INDEX_NAME,       -- 인덱스 이름
    COLUMN_NAME,      -- 컬럼 이름
    COLUMN_POSITION   -- 인덱스에서 컬럼의 순서
FROM ALL_IND_COLUMNS
WHERE TABLE_NAME = 'TB_COMPANY_MASTER'
ORDER BY INDEX_NAME, COLUMN_POSITION;
```

| INDEX\_NAME | COLUMN\_NAME | COLUMN\_POSITION |
| :--- | :--- | :--- |
| IDX\_COMPANY\_CEO\_UPPER | SYS\_NC00019$ | 1 |
| IDX\_COMPANY\_COVER\_CAT\_NM | COMPANY\_TYPE\_CAT | 1 |
| IDX\_COMPANY\_COVER\_CAT\_NM | COMPANY\_NM | 2 |
| IDX\_COMPANY\_EST\_DT | ESTABLISH\_DT | 1 |
| IDX\_COMPANY\_NM | COMPANY\_NM | 1 |
| PK\_COMPANY\_MASTER | BIZ\_REG\_NO | 1 |
| SYS\_C008505 | COMPANY\_CD | 1 |

## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="indexing" quizItems={
    [
  {
    "item_type": "radio",
    "question": "SQL 실행 계획(Execution Plan)에서 `CARDINALITY` 항목이 의미하는 것은 무엇인가요?",
    "options": [
      "SQL 구문의 실행 순서",
      "예상되는 실행 비용",
      "예상되는 실행 결과 행 수",
      "쿼리 처리에 사용된 연산자(OPTIONS)"
    ],
    "hint": "이 값이 실제 결과와 크게 다를 경우 질의가 비효율적일 수 있습니다.",
    "solution": "예상되는 실행 결과 행 수"
  },
  {
    "item_type": "radio",
    "question": "비용 기반 옵티마이저(Cost-Based Optimizer)가 최종 실행 계획을 선택하는 기준은 무엇인가요?",
    "options": [
      "가장 많은 인덱스를 사용하는 계획",
      "통계 정보를 바탕으로 추정한 비용(Cost)이 가장 낮은 계획",
      "사용자가 작성한 SQL 구문 순서와 가장 유사한 계획",
      "가장 적은 수의 조인을 사용하는 계획"
    ],
    "hint": "여러 '후보 실행 계획'을 생성하고 통계 정보를 바탕으로 각 계획의 '비용'을 추정합니다.",
    "solution": "통계 정보를 바탕으로 추정한 비용(Cost)이 가장 낮은 계획"
  },
  {
    "item_type": "checkbox",
    "question": "인덱스(Index)의 단점에 대한 설명으로 옳은 것을 모두 고르세요.",
    "options": [
      "테이블 조회 속도를 향상시킨다.",
      "인덱스 관리를 위한 추가 저장 공간이 필요하다.",
      "데이터가 변경(INSERT, UPDATE, DELETE)될 때 인덱스도 변경되어야 하므로 추가 작업이 필요하다.",
      "잘못 사용하면 오히려 성능이 저하될 수 있다."
    ],
    "hint": "인덱스는 검색 속도를 높이는 대신 유지 관리에 비용이 듭니다.",
    "solution": [
      "인덱스 관리를 위한 추가 저장 공간이 필요하다.",
      "데이터가 변경(INSERT, UPDATE, DELETE)될 때 인덱스도 변경되어야 하므로 추가 작업이 필요하다.",
      "잘못 사용하면 오히려 성능이 저하될 수 있다."
    ]
  },
]
} />


## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>