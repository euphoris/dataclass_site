# GROUP BY

## GROUP BY 절을 사용한 데이터 그룹화

*   **`GROUP BY` 절의 역할**: 특정 열(들)의 값이 동일한 행들을 하나의 그룹으로 묶어, 각 그룹에 대한 요약 정보(집계 값)를 계산할 때 사용.
*   **동작 원리**:
    *   `FROM` 절에서 테이블 지정.
    *   `WHERE` 절에서 개별 행 필터링 (있는 경우).
    *   `GROUP BY` 절에 명시된 열(들)을 기준으로 행들을 그룹화.
    *   `SELECT` 절에서 각 그룹별 집계 함수 결과 또는 `GROUP BY`에 사용된 열을 조회.

```sql
SELECT column_to_group_by1, column_to_group_by2, ..., aggregate_function(column)
FROM table_name
WHERE condition -- (선택 사항, 그룹화 전 필터링)
GROUP BY column_to_group_by1, column_to_group_by2, ...
ORDER BY ...; -- (선택 사항, 그룹화 후 결과 정렬)
```

*   **주의**: `SELECT` 절에는 `GROUP BY` 절에 명시된 열이나 집계 함수만 올 수 있음 (표준 SQL 기준, 일부 DBMS는 유연성 제공).

## GROUP BY 절을 사용한 데이터 그룹화

*   **예시**: `TB_COMPANY_MASTER` 테이블에서 `COMPANY_TYPE_CAT` (기업구분범주값) 별로 회사 수 세기

```sql
SELECT COMPANY_TYPE_CAT, COUNT(*) AS "기업 수"
FROM TB_COMPANY_MASTER
GROUP BY COMPANY_TYPE_CAT;
```

*   **예시**: `TB_LOAN_ACCOUNT` 테이블에서 `BIZ_REG_NO` (사업자등록번호) 별로 총 `LOAN_AMT` (여신금액) 합계 구하기

```sql
SELECT BIZ_REG_NO, SUM(LOAN_AMT) AS "총 여신금액"
FROM TB_LOAN_ACCOUNT
GROUP BY BIZ_REG_NO;
```

## COUNT 집계 함수

*   **집계 함수 (Aggregate Functions)**: 여러 행의 값을 바탕으로 단일 결과 값을 반환 (주로 `GROUP BY` 절과 함께 사용되나, 단독 사용 시 전체 테이블 대상).

*   **`COUNT(*)`**: 그룹 내 전체 행의 수 (`NULL` 값 포함).
*   기업구분별 전체 회사 수

```sql
SELECT COMPANY_TYPE_CAT, COUNT(*) AS "전체 회사 수" FROM TB_COMPANY_MASTER
GROUP BY COMPANY_TYPE_CAT;
```

*   **`COUNT(컬럼명)`**: 그룹 내 해당 컬럼의 값이 `NULL`이 아닌 행의 수.
*   신용등급이 있는(`NULL`이 아닌) 신용정보 건수(사업자번호별)

```sql
SELECT BIZ_REG_NO, COUNT(CREDIT_GRADE) AS "신용등급 보유 건수"
FROM TB_CREDIT_INFO GROUP BY BIZ_REG_NO;
```

*   **`COUNT(DISTINCT 컬럼명)`**: 그룹 내 해당 컬럼의 중복을 제외한 유일한 값의 개수.
*   여신을 받은 회사 수(중복 제외)

```sql
SELECT COUNT(DISTINCT BIZ_REG_NO) AS "여신 보유 회사 수" FROM TB_LOAN_ACCOUNT;
```

## 합계와 평균

*   **`SUM(컬럼명)`**: 그룹 내 해당 컬럼 값의 합계 (숫자형 데이터에 사용).
*   **예시**: `TB_FINANCIAL_STATEMENT`에서 회사별 총 `REVENUE` (매출액)

```sql
SELECT BIZ_REG_NO, FS_TYPE, SUM(REVENUE) AS "총 매출액"
FROM TB_FINANCIAL_STATEMENT
WHERE FS_TYPE = 'ANNUAL'
GROUP BY BIZ_REG_NO, FS_TYPE;
```

*   **`AVG(컬럼명)`**: 그룹 내 해당 컬럼 값의 평균 (숫자형 데이터에 사용, `NULL` 값 제외).
*   **예시**: `TB_LOAN_ACCOUNT`에서 여신종류별 평균 `INTEREST_RATE` (금리)

```sql
SELECT LOAN_TYPE_CD, AVG(INTEREST_RATE) AS "평균 금리"
FROM TB_LOAN_ACCOUNT
GROUP BY LOAN_TYPE_CD;
```

## 최대, 최소

*   **`MAX(컬럼명)`**: 그룹 내 해당 컬럼 값의 최대값.
*   **`MIN(컬럼명)`**: 그룹 내 해당 컬럼 값의 최소값.
*   **예시**: `TB_FINANCIAL_STATEMENT`에서 회사별 연간 `NET_INCOME` (당기순이익)의 최대/최소값

```sql
SELECT BIZ_REG_NO,
    MAX(NET_INCOME) AS "최대 순이익",
    MIN(NET_INCOME) AS "최소 순이익"
FROM TB_FINANCIAL_STATEMENT
WHERE FS_TYPE = 'ANNUAL'
GROUP BY BIZ_REG_NO;
```

## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="group-by" quizItems={
[
  {
    "item_type": "radio",
    "question": "다음 중 `GROUP BY` 절에 대한 설명으로 가장 올바르지 않은 것은?",
    "options": [
      "특정 열의 값이 같은 행들을 하나의 그룹으로 묶기 위해 사용한다.",
      "WHERE 절은 그룹화가 실행되기 전에 개별 행을 필터링한다.",
      "GROUP BY를 사용하면 SELECT 절에는 어떤 컬럼이든 자유롭게 표시할 수 있다.",
      "SUM(), AVG()와 같은 집계 함수와 함께 사용하여 그룹별 통계를 계산한다."
    ],
    "hint": "SELECT 절에 올 수 있는 컬럼은 GROUP BY 절에 명시되거나 집계 함수로 처리되어야 합니다.",
    "solution": "GROUP BY를 사용하면 SELECT 절에는 어떤 컬럼이든 자유롭게 표시할 수 있다."
  },
  {
    "item_type": "radio",
    "question": "다음 COUNT 함수 사용법 중, TB_COMPANY_MASTER 테이블에서 중복을 제외한 COMPANY_TYPE_CAT의 순수한 종류 개수를 세는 쿼리는 무엇인가요?",
    "options": [
      "SELECT COUNT(COMPANY_TYPE_CAT) FROM TB_COMPANY_MASTER;",
      "SELECT COUNT(*) FROM TB_COMPANY_MASTER;",
      "SELECT COUNT(DISTINCT COMPANY_TYPE_CAT) FROM TB_COMPANY_MASTER;",
      "SELECT COUNT('COMPANY_TYPE_CAT') FROM TB_COMPANY_MASTER;"
    ],
    "hint": "중복을 제거하는 SQL 키워드를 생각해보세요.",
    "solution": "SELECT COUNT(DISTINCT COMPANY_TYPE_CAT) FROM TB_COMPANY_MASTER;"
  },
  {
    "item_type": "long",
    "question": "TB_LOAN_ACCOUNT 테이블에서, 회사(BIZ_REG_NO)별로 총 여신 잔액(LOAN_BALANCE)의 합계를 구하는 SQL 쿼리를 작성하세요",
    "options": [],
    "hint": "먼저 BIZ_REG_NO로 그룹화(GROUP BY)하고, SUM(LOAN_BALANCE)을 계산합니다.",
    "solution": "SELECT BIZ_REG_NO, SUM(LOAN_BALANCE) FROM TB_LOAN_ACCOUNT GROUP BY BIZ_REG_NO;"
  },

]
} />


## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>