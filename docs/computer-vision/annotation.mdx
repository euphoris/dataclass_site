# 물체 탐지 데이터셋 만들기

## LabelStudio
*   https://labelstud.io

## 설치 및 실행
*   아나콘다 프롬프트에서
*   설치
    ```
    pip install -U label-studio
    ```
*   실행
    ```
    label-studio
    ```
*   http://localhost:8080 으로 접속

## 회원 가입 및 로그인

## 프로젝트 만들기

* 이름 및 설명
* 데이터 불러오기
    *   사용할 이미지 파일을 여기에 끌어다 놓음(Drag & Drop)
    *   프로젝트를 만든 후 나중에 가져올 수도 있음
* 레이블링 셋업
    *   경계 상자와 물체 탐지 (Object Detection with Bounding Boxes)
* 레이블링 인터페이스 설정
    *   레이블 추가
    *   X 클릭하여 삭제
    *   경계 상자 선 굵기
    *   확대/축소 허용
    *   확대/축소 버튼
    *   회전 버튼
    *   레이블 표시 위치
    *   레이블 검색창

## 레이블링 방법
1.  레이블 클릭
2.  마우스로 경계상자 그림 (왼쪽 위에서 오른쪽 아래로 드래그)
3.  수정하려면 여기를 클릭

## 내보내기
*   프로젝트 화면에서 Export 클릭
*   YOLO with Images 선택

## data.yaml 예시
data.yaml 파일을 아래와 같이 만들어 압축 파일 안에 추가
```yaml
train: images # train 데이터의 폴더
val: images # validation 데이터의 폴더(여기서는 임시로 똑같게)
nc: 1 # 클래스 개수
names: ['clip'] # 클래스 이름 (Label Studio에서 사용한 순서와 동일하게)
```

## 미세 조정
*   설치
    ```python
    pip install ultralytics
    ```
*   colab에 데이터셋 압축 파일 업로드
*   압축 해제
    ```python
    !unzip detection-annotation.zip
    ```
*   학습
    ```python
    from ultralytics import YOLO
    model = YOLO("yolo11n.pt")
    model.train(data="data.yaml", epochs=100)
    ```

## 미세 조정 결과
*   출력:
    *   각 에폭(Epoch)마다 Loss 값 (객체 감지, 분류, 박스 회귀 등) 감소 확인.
    *   Precision, Recall, mAP@0.5, mAP@0.5:0.95 값 상승 확인.
*   결과 저장 폴더:
    *   runs/detect/train/ 폴더에 학습 결과 저장.
    *   weights/best.pt: 가장 좋은 성능을 낸 모델 가중치.
    *   results.csv: 에폭별 상세 성능 지표.
    *   results.png: 학습 Loss 및 mAP 그래프.
*   그래프 확인:
    *   results.png 파일을 열어 Loss가 안정적으로 감소하고 mAP가 증가하는지 확인.
    *   과적합 징후 (Validation Loss 증가, Validation mAP 감소) 확인.

## 모델 개선 방향
*   데이터셋:
    *   데이터 부족: 더 많은 데이터를 수집하거나 증강
    *   어노테이션 오류: 라벨링 정확성 재검토 (Label Studio에서 수정).
    *   클래스 불균형: 소수 클래스 데이터 증강.
    *   이미지 품질: 저해상도, 노이즈 문제 확인.
*   학습 파라미터:
    *   에폭 수(epochs): 더 많은 에폭 학습 (과적합 주의).
    *   학습률(lr): 너무 높거나 낮지 않은지 확인 (조절).
    *   배치 크기(batch): GPU 메모리에 맞춰 최적화.
*   사전 학습된 모델: 모델 크기: 더 큰 YOLO 모델을 시도하거나 다른 사전 학습 모델 사용


{/* 

# 데이터 만들기


그러면 우리가 예제 데이터 가지고 돌려봤는데 예제 데이터가 아니라 진짜 데이터로 하려면 데이터를 직접 만들어야겠죠.

데이터를 만들려면 이미지 분류는 그냥 폴더 구별하면 되니까 쉬운데 물체 탐지는 그 박스를 쳐야 되기 때문에 툴이 필요해요.

툴을 여러분이 직접 만드셔도 되지만 이미 있기 때문에 굳이 만드실 필요 없겠죠.

여러가지 툴이 있는데 무료로 쓸 수 있는 레이블 스튜디오라는 툴이 있습니다.

요거는 온라인으로 쓸 수도 있고 다운받아서 쓸 수도 있는데요.

일단 여기 링크되어 있는 주소로 가시면 able studio 이렇게 홈페이지가 있는데요.

여기 오른쪽 아래 보시면 알겠지만 설치하는 건 굉장히 간단한데 일단 설치는 좀 이따 해보고 일단 여기 들어가셔서 이거 어디죠?

이거 quick start 말고요.

잠깐만요.

use case에 마우스를 이렇게 얹어 보시면 use case 마우스 얹어 보시면 playground라고 있거든요.

놀이터 이런 뜻입니다.

그래서 playground를 클릭해서 들어가 보세요.

그러면은 여기에 annotation template 이래가지고 여기서 할 수 있는 분류가 뭐가 있는지 나오는데요.

여기 헤드셋 모양 아이콘에 있는 거는 소리와 관련된 작업들이고 오디오 분류, 감정 표시하는 거 그다음에 이건 뭔지 잘 모르겠고요.

그다음에 transcription을 받아쓰기 하는 거 이런 거고 그다음에 여기 그림 모양 아이콘인데 밑에 있는 게 이미지 관련된 건데 이미지 클래시피케이션 이게 우리가 했던 이미지 분류하는 건데 사실 이거는 그냥 폴더로 구별하면 되니까 굳이 필요는 없는데 어떨 때 필요하냐면 같은 사진을 우리가 한 명한테 맡겨놓으면 사진을 대충 분류할 수 있거든요.

같은 사진을 여러 명이 분류를 한 다음에 예를 들어 세 명이 분류했는데 두 명은 강아지라고 하고 한 명은 고양이라고 한다.

그럼 다수결로 한다든지 아니면은 이거는 강아지일 확률이 66%라고 하든지 뭐 이런 식으로 할 수 있어요.

그럴 때는 이런 툴을 쓰실 수가 있습니다.

근데 우리가 이제 그냥 혼자서 폴더 구별을 할 때는 이제 필요 없겠죠.

그다음에 여기 두 번째 있는 bbox detection이 우리가 지금 하고 있는 바운딩 박스, 경계 상자로 네모로 쳐서 이렇게 하는 거고요.

브러쉬 세그멘테이션은 뭐냐면 상자로 치는 게 아니라 이렇게 색칠을 하는 거예요.

그래서 사람이면 사람 모양으로 색깔을 해 주는 겁니다.

그래서 이제 이렇게 여러 가지가 있는데 여기는 bbox objective detection을 해 보도록 하겠습니다.

두 번째 그래서 들어가 보면은 여기 클릭해 보시면은 오른쪽에 이렇게 예시가 있거든요.

inspect interface preview 해가지고 예시가 있는데요.

그래서 이제 어떻게 하냐면은 사용법을 연습을 해 볼 수 있는 거예요.

그래서 여기 에어플레인하고 카가 있는데 그러니까 이제 이런 사진이 있으면 비행기랑 자동차를 여러분이 다 표시해 주면 그게 이제 데이터 포인트 하나가 되는 겁니다.

이렇게 있으면 에어플레인을 클릭을 하시고 에어플레인이 선택이 되죠.

비행기를 이렇게 마우스로 선택을 해 주시면 돼요.

선택이 끝나면 이제 그다음 비행기가 있죠.

그다음 비행기를 이렇게 또 선택을 해 주시면 됩니다.

또 비행기가 하나 더 있죠.

이렇게 또 선택을 해 주시면 됩니다.

그다음 자동차도 자동차 되게 많은데 하나씩 이렇게 선택을 해 주시는 거예요.

제가 왜 object detection을 가능하면 하지 말라고 하는지 아시겠죠?

이걸 한번 당해봐야 아 이거는 정말 필요할 때가 아니면 하면 안 되겠구나

이런 생각이 듭니다.

그래서 이제 직접 하지 마시고 꼭 알바를 시키세요.

이런 식으로 해서 이제 데이터를 만드는 겁니다.

그래서 하단에 보시면 이렇게 선택된 영역들이 쫙 나오죠.

어떻게 돌아가는지 이제 좀 가면 오시나요?

그래서 이거 외에도 뭐 여러 가지 할 수 있는데 이게 뭐 해보면 브러쉬 세그멘테이션 같은 경우는 예를 들면은 비행기다 그러면은 이제 이거는 이렇게 칠해 줘야 돼요.

아 미친다.

칠하다가 이제 잘못 칠하면 지우고 다시 칠해야 된다.

환장하겠죠?

그러니까 이런 거는 왜 안 하는지 아시겠죠?

데이터를 한번 직접 만들어 보시는 게 굉장히 큰 교훈을 준다.

이렇게 한번 해보시면은 아 이거 절대 하지 말아야 된다는 생각이 들거든요.

이게 알바를 시키더라도 이게 뭐 하려고 하겠습니까?

이거 사진 이거 비행기 다 칠해야 되는데 언제 칠하고 있어요?

그 다음에 이제 circular object detection 이거는 아이고.

삭제.

원형으로 이렇게 원으로 칠한 거.

그러니까 사각형 대신에 이제 동그라미로 하는 거고.

그 다음에 key point and landmark detection 이거는 원래 이제 비행기 이런 거 하면 이제 잘 안 하는데 이렇게 점으로 찍는 거예요.

그래서 주로 이제 어디에 하냐면 사람 팔꿈치라든지 뭐 관절을 인식시킨다든지 얼굴이 있으면 입꼬리를 인식시킨다든지.

이제 그 사각형으로 치기 뭐하고 점으로 찍어야 되는 거죠.

이렇게 이제 점을 찍어주면은 엔진에 점이 타면 삭 찍힙니다.

그래서 뭐 이런 것들이 있고요.

그래서 한번 이렇게 뭐 들어가서 이제 해보시면은 이거는 이제 뭐 고잉이냐 에어버스.

뭐 그렇게 어렵지는 않은데 우리가 할 거는 이제 빅박스 오디션이고요.

그래서 이제 대략 어떤 툴인지는 이제 봤으니까.

설치를 한번 해봅시다.

그래서 설치하는 거는 여기 보시면 이제 prp install label studio 이렇게 되는데.

이거 이제 복사해가지고 우리 아나콘다 프롬프트에 그냥 붙여넣으시면 돼요.

여기 홈페이지에 첫 페이지에 있는 대로.

prp install-u label. 여기가 대문점이다.

그냥 복사해서 붙여넣으세요.

설치 다 되신 분은 그 밑에 보시면 런치 돼가지고 이렇게 칠하고 있죠.

그래서 설치 다 되신 분들은 레이블 빼기 스튜디오라고 아나콘다에 써주시면 됩니다.

네.

아 이거는 상관 없을 겁니다.

레이블 빼기 스튜디오도 적어주세요.

됐어요.

보안 질문이 뜨면 그냥 허용 눌러주세요.

허용 눌러주시고 그러면은 이제 여러분 웹브라우저에 이런 사이트가 뜰 겁니다.

근데 이 사이트가 주소를 보시면 이게 로컬 호스트거든요.

여러분 컴퓨터 안에 이 사이트가 되어 있는 거예요.

그래서 그 이제 이 컴퓨터가 여러분 각자의 서버가 됩니다.

그래서 회사 내에서도 이걸 이제 운용하시려면 회사 내부 이거 컴퓨터에 포트를 외부로 여겨주시면 됩니다.

그래서 이렇게 이렇게 열 수가 있거든요.

그래서 열어놓으면 옆에 있는 컴퓨터에서 이쪽 컴퓨터에 이제 접속을 할 수 있습니다.

회사 내부에서만 운영되는 사이트 같은 걸 만드실 수가 있어요.

그래서 이렇게 이제 만드시면 되고요.

그 다음 여기 이제 사이트 뜨신 분들은 지금 여기ダ apostles 여기 밑에 보면은 조그맣게 사인업이라고 있거든요.

사인업이 회원가입입니다.

회원가입을 해 주시는데 회원가입이랑 그 뉴스 레터 받기가 있는데 요거는 체크를 풀어주세요

안그럼 맨날 메일 옵니다

그래서 이제 이메일 주소는 뭐 자기 개인이나 써주시고 비밀번호는 어차피 여러분 컴퓨터에서 돌리는거라 비밀번호는 별 상관없어요

뭐 1234 이런거 123서 되던가

아 8글자 되야 되는군요

12345678 비밀번호는 그냥 뭐 숫자로 12345678 하시면 되요 회원가입 하시면 바로 로그인 되면서 요 화면이 떠요

여기까지 잘 되시나요

안되시면 언제든지 얘기해 주세요

그래서 여기 보면은 프로젝트가 없네요

하나 만드세요

나오죠

그래서 시키는 대로 하시면 됩니다

하나 만들라고 하니 만들어 주죠

뭐 여기 파란색 크리에이트 프로젝트 버튼 누르시면 이제 프로젝트 이름이랑 설명이랑 이렇게 하는데 워크스페이스 요기는 돈 내야 쓸 수 있는 거라서 공짜 버전에서는 안되구요

이름을 정해주시면 되는데 이름은 자유롭게 쓰시면 되구요

이름을 정해주시면 되는데 이름은 자유롭게 쓰시면 됩니다

우리가 이제 뭐 물체의 탐지 같은걸 하려고 한다 물체의 탐지 프로젝트 이름은 적당히 써주시면 됩니다

파일이니까 디스크립션은 쓰셔도 되고 안쓰셔도 되고 뭐 필요하시면 재미있는 컴퓨터 비전 수업 마지막 날을 해보시면 됩니다.

재미있는 컴퓨터 비전 수업 마지막 날을 해보시면 됩니다.

써주시면 되구요

그 다음에 이제 여기 상단에 보시면 프로젝트 네임이 있고 데이터 임포트가 있는데요

데이터 임포트로 들어가시면은 데이터를 인터넷에 다운을 받을 수도 있고 아니면은 여러분 컴퓨터에 있는 걸 업로드 할 수도 있습니다

만약에 이제 포트를 열어 가지고 외부에서 접속할 수 있겠다

그러면 이제 외부 우리가 예를 들어서 알바 를 열어야 되는데 외부 우리가 예를 들어서 알바 를 열어야 되는데 외부 우리가 예를 들어서 알바 를 열어야 되는데 그 다음에 10명을 고용했으면은 이제 컴퓨터 한대 놓고 알바 를 쓸 컴퓨터 열대 놓고 이걸 다 물려 놓은 다음에 알바들이 각자 자기가 파일을 업로드 하게 하시면 됩니다.

그래서 여기다가 끌어다 놔도 되구요

아니면은 파일은 나중에 올려도 되거든요

그래서 일단은 나중에 올리도록 하고 요거는 일단 패스하고 그 다음에 이제 레이블링 셋업으로 들어가면 이렇게 이제 작업 종류가 있는데 컴퓨터 비전에 보면은 이렇게 여러가지 종류의 작업들이 있죠

그래서 이제 예시의 그림이 있어서 보시면 어떤건지 알 수 있는데 제일 첫번째 것은 이렇게 테두리를 다 선을 쳐 가지고 테두리로 감싸는 겁니다 비행기가 있으면 빨간색 선으로 이렇게 다 감싸왔죠

그 다음에 요거는 색깔을 다 칠해주는 거에요

아까 제가 하다가 아 때려쳐야지 안하고 있죠

요거는 사각형 치는 거에요

그 다음에 요거는 중요한 포인트에 점을 찍으면 관절 같은 데다 점 찍는 거에요

그 다음에 이미지 캡셔닝은 뭐냐면 이미지가 있으면 설명을 말로 달아주는 겁니다

그래서 여기 눈 덮인 나무가 있는데 눈 덮인 나무, 아름다운 겨울, 러시아 어딘가 뭐 이렇게 써주는 거구요

이미지 분류는 그냥 이미지가 전체적으로 뭐다 강아지 고양이 이런거 분류할 때 하는 거구요

인벤토리 트래킹 이건 저도 모르겠는데 대충 보니까는 뭐 이렇게 이미지들이 있으면 요거 몇 개 있는지 세주는 그런 거 같아요

그 다음 요거는 OCR 문자인식이구요

요거는 뭔지 잘 모르겠고 요거는 이제 VQA 라고 해서 질문을 하면은 뭐 예를 들면 여기 빨갛고 가운데 있는 큰 거 뭐야 02형 뭐 이렇게 대답하는 자연화 처리랑 이미지 처리랑 섞인 뭐 이런 거는 그래서 이제 여기 있는 이런 형식의 과제들을 다 데이터를 만들 수 있는데 우리는 오브젝트 여기 세 번째에 있는 오브젝트 디텍션 위드 바운딩 박스 요거를 하도록 하겠습니다

선택을 해주고요 그래서 이제 선택을 해서 들어가시면 여기에 이제 add names 라고 돼 있는데 분류하고 싶은 종류가 있으면 아 뭐 잘 안되세요?

실행이 안되는데

아 그래 여기에서 알았습니다

여기다가, 안되신 분은 여기서 그 세 번째 거를 선택하세요

네 사이즈가 없어서 이걸로 해야 되는 건가?

안가고 네, 네이블링으로 넘어가세요

자 그래서 우리가 이제 뭐 여러분이 실제로 그 탐지할 물체들이 있을 거 아니에요

여기는 이제 예시로 개인기랑 자동차 이렇게 돼 있는데 뭐 뭘 탐지해 볼까요?

뭐 예를 들면 나는 태권브이를 탐지하겠다

뭐 그러면은 여기다가 이제 태권 브이 뭐 이렇게 해서 add 이렇게 해주면 태권브이가 추가가 되죠

나는 태권브이랑 사람이랑 뭐 이렇게 탐지를 하겠다

뭐 이렇게 쓰시면 되고 에어플레인이랑 칸은 필요 없으니까 이렇게 지우면 되겠죠

그다음에 이제 여기 색깔은 여기 옆에 볼록 튀어나온 데가 있는데 이거 누르시면은 태권브이는 파란색으로 표시하고 사람은 빨간색으로 표시하고 이렇게 레이블을 지정을 해 주시면 됩니다

그래서 이제 한번 테스트를 해 보면 이런 식으로 되는구나

파란색이 뭐 색깔이 좀 그어보니까 마음에 안 든다

그러면은 이제 딴 색으로 바꾸시면 되고요

자 그다음에 여기 이제 왼쪽 하단에 있는 거는 뭐 여러 가지 옵션인데 allow image zoom 이거는 이제 체크를 하면은 휠을 돌리면은 왜 휠 돌리는 게 안 되죠

아 컨트롤 휠이구나 컨트롤 휠을 누르면 이렇게 줌이 되는 거 이걸 이제 끄면은 그 줌 기능을 못쓰는데 나는 줌 기능을 알바들한테 안 주겠다

그럼 꺼 두시면 되고요 그다음에 두 번째 show control to zoom in and out은 이걸 켜시면은 그 줌 인 줌 아웃 버튼이 생기고요 끄면은 없어지죠

이거 이제 껐다 켰다 하실 거에요

그다음에 이제 rotate 이미지 이거를 켜시면 이미지를 이렇게 회전시킬 수 있는 UI를 이제 여러분이 제어하실 수 있어요

그리고 뭐 어떤 기능이 있는지 제가 지금 공부하고 있는 거에요

사실 다 별거 아닙니다

display labels bottom은 이제 밑에다 표시하는 거고 top은 위에다 표시하는 거고 요건 이제 편한 대로 하시면 될 거 같고요 그다음에 이제 마지막에 add filter for long list of labels인데 이건 뭐냐면 레이블이 지금은 두 개밖에 없으니까 그냥 보고 고르면 되는데 레이블이 한 100개쯤 있다

예를 들면 우리가 부품이 한 100개 있어가지고 사진 하나를 딱 찍으면 뭐 뭐 뭐 뭐 있는지 짜라랑 나오게 하고 싶다

근데 부품 이름이 한 100개 있으면 이거 찾는데도 오래 걸릴 거 아니에요?

그래서 여기 quick filter는 이제 한 100개가 있는데 이 필터에다가 예를 들어서 우리가 이제 v 이렇게 하면은 태권브이만 나오고 빨리 찾기 그다음에 이제 삭 이렇게 하면 사람 나오죠

그래서 요거를 이제 체크하시면 여기 이제 검색창 같은 게 하나 생겨가지고 이 태그가 많을 때 빨리 찾게 해줍니다

이거는 뭐 취향대로 필요에 따라서 선택하시면 되고요 특별히 할 건도 없죠

그래서 이제 save 누르면은 이제 물체탐지 프로젝트 102 새 프로젝트가 생깁니다

맨 처음으로 가려면 여기 프로젝트 누르시면은 아까 만든 프로젝트가 이렇게 보이고요 다시 이제 언제 만들었지

뭐 이런 게 있죠

들어가 보면 여기 아무것도 없는데 왜냐면 이미지를 안 넣어놔서 그래요

여기다가 이제 go to import 하면은 아까 닫았던 넘어갔던 창이 다시 뜹니다

그래서 여기다가 이제 여러분들이 넣고 싶은 이미지를 그냥 던져 넣으시면 되는데요 뭐 이건 이제 취향대로 하시면 되는데 연습해보는 거니까요 우리는 저는 태권브이를 해볼게요

이건 여러분들 마음대로 해보세요 여기 101 오브젝트 카테고리 가도 뭐 다른 것도 있으니까 다른 거 하셔도 되고 근데 연습이니까 저는 태권브이를 하겠습니다

그래서 태권브이가 1,2,3이 있는데 태권브이 1,2,3을 다 이렇게 끌어다 놓으면 넣고 import 어 제가 원한 건 이게 아닌데 이거 말고 미리 보기 아 여기 있다

여기 있다

피규어 피규어 피규어를 하려고 그랬었는데 태권브이를 골랐네요

피규어 1,2,3,4,5 여기 있는데 같은 게 두 개 있죠

이거를 다시 import하고 해가지고 다 넣으실 필요는 없고 그냥 이거 다섯 개 올린 다음에 import 누르면은 이렇게 등록이 됩니다

이미지들이 그리고 이제 필요 없는 거는 필요 없는 거는 여기 체크해가지고 필요 없는 거는 왼쪽에 여기 체크박스가 있거든요

체크하셔가지고 여기 상단에 보시면 three test 게 선택이 되오듯은 여기 보시면 ви투태스크 하면은지울수 Bart 아 이게 잘못했네

작업만 지울때 파일은 놔두고 작업이다곱을 줄 때 오 황합 와우 아 오 Ha 이렇게 돼 있고 그 다음에 작업을 하시려면 이제 오늘 할 작업을 선택을 해가지고 제일 위꺼를 선택을 하겠습니다

그러면 이제 사진이 뜨죠

그래서 아까처럼 태권부위 선택해 가지고 네모로 이렇게 채우고 그 다음에 아톰은 사람이 아니지만 사람은 이렇게 이런식으로 네모를 이렇게 쳐주시면 되구요

그러니까 이제 우리가 그 템플릿 매칭 했을 때 하고 좀 다를 템플릿 매칭은 템플릿이 있고 그 템플릿하고 일치하는 걸 찾아주는데 얘는 우리가 데이터를 이렇게 만들어 주면 학습을 해서 태권부위가 좀 다르게 생겼어도 뿔이 없다던가 눈이 하나 없다던가 이래도 이제 대충 비슷하면 찾아주는거죠

아 여기 왼쪽 밑에 보시면 태권부위 사람 뭐 이렇게 있잖아요

그래서 이걸 하나 누르시고 그럼 이제 일단 한번 보시면 화면이 약간 여기 선택을 하면은 이게 파란 지금 보시면은 파란색이 되고 사람을 지금 연한색인데 선택하시면 빨갛게 되죠

이렇게 빨갛게 됐을 때 마우스로 요렇게 사각형을 그리십니다

그 다음에 이제 했는데 아 잘못했다

그럼 어떻게 하면 되죠?

왜냐하면 이 사각형을 다시 선택을 하시면 요렇게 이렇게 점이 찍히거든요

그래서 요걸اه 이렇게 크기를 바꾸거나 아니면 요렇게 마우스를 잡아서 옮길 수 있어요 지울 수 있죠

지울 수 있도록 지우려면은쁘다

그런데 여기 보시면 빨간색으로 쓰레기통 모양 버튼이 있어요

그래서 이거를 누르시면 삭제가 됩니다

그리고 여기 오른쪽 하단에도 보시면 있는데 여기서 이렇게 누르면은 이거 선택이 이렇게 돼요

이걸 누르셔도 되고 박스를 누르셔도 되고 여기서 누르셔도 됩니다

네 그래서 이제 다 했으면은 여기 하단에 보시면 서브밋 버튼이 있거든요

이게 제출 버튼입니다

이거 누르시면은 저장이 됩니다

그래서 이제 뭐 이런 식으로 다 시켜놓고요 몇 개만 한번 해보세요 연습 삼아 한두 개만 해보면 되겠죠

여러분들이 할 줄 아셔야 돼 알바 남들한테 시키더라도 이렇게 하는 거야

이렇게 시키니까 막상 해보면 좀 재밌습니다

아무 생각 없이 그냥 이렇게 약간 단순 작업의 장점이죠

그래서 이제 이렇게 일단 다 해보세요 잠깐 하실 시간 좀 드리겠습니다

뭐 열심히 할 필요는 없는데 그래도 좀 한번 몇 개 해보시면은 아 나중에는 여러분들이 이걸 가르쳐 주셔야 되거든요

남들은 사용 방법이 그렇게 어려운 건 아니니까 한번 해보시고 다음에는 다른 분들에게도 좀 더 가르쳐 주시면 되겠습니다

한번 해보시면 됩니다

툴이 되게 잘 만들어져 있어요

이렇게 일단 해보셨으면 그 다음에 이제 이거를 파일로 내보내기를 해야겠죠

그래서 다시 여기 프로젝트 옆에 누르시면은 또 목록으로 돌아오거든요 보시면 이제 1 1 1 1 이렇게 해서 이제 레이블링이 됐다 이런 표시가 있고 여러 명이 작업할 수도 있기 때문에 그럼 예를 들면 두 사람이 작업했으면 2 이렇게 나옵니다

이렇게 나오고요

그렇게 이제 다 작업을 했으면 여기 보시면은 상단 오른쪽에 export라고 내보내기가 있습니다

import는 불러드리는 거고 export는 내보내는 건데 export 누르시면은 형식을 눌러봐요

그래서 어떤 형식으로 할까

이렇게 물어보는데 뭐 여러 가지 형식이 있는데 우리 기억이 나실지 모르겠지만 아까 우리가 그 변환을 할 때 코코 형식으로 변환을 했거든요

그래서 내보내기 할 때 코코 형식으로 내보내시면 좀 편합니다

그래서 코코를 선택을 해주시고요

그리고 이제 export 누르면은 파일을 저장하시겠습니까

이렇게 물어보는데 저장하면 되겠죠

그래서 여기 이제 압축파일이 있는데 압축파일을 열어보시면 그 안에 result.json이 있고요 images가 있습니다

압축파일 안에 보시면 그래서 이거를 두 개를 선택을 해가지고 우리 작업하고 있는 폴더에다가 이 이미지들을 압축파일 안에 보시면 이 이미지들을 압축파일 안에 보시면 이 이미지들을 압축파일 안에 보시면 이 이미지들을 압축파일 안에 보시면 압축을 풀어주시면 돼요

압축을 풀어주시면 돼요

그러면은 이제 다 끝났습니다

이제 우리 작업도 했고 이미지도 여기 있고 그러면 불러오기만 하면 되거든요 불러오는 코드는 제가 짜놨는데 이쪽이냐면 399쪽을 보시면 399쪽을 보시면 불러오는 코드가 있는데요 불러오는 코드가 있는데요

그래서 그래서 이렇게 하시면은 이렇게 하시면은 result.json을 불러오고요 result.json을 불러오고요 그래서 annotation result를 보시면 annotation result를 보시면 이미지마다 이 이미지는 가로가 얼마고 세로가 얼마고 파일 이름은 여기 폴더에 있는 이 이름이고 파일 이름은 여기 폴더에 있는 이 이름이고 그 다음에 카테고리가 0번은 사람 그 다음에 카테고리가 0번은 사람 1번은 태권브이 우리는 태권브이가 먼저 있었는데 사람이 먼저 나왔죠

왜 그럴까요

가나다순으로 사람이 먼저 나왔습니다

가나다순으로 사람이 먼저 나왔습니다

그 다음에 annotation에 보시면 id도 자동으로 붙어있고 id도 자동으로 붙어있고 카테고리 id는 1번 태권브이죠

bbox는 좌표랑 가로 세로 포기고 bbox는 좌표랑 가로 세로 포기고 part로OOK она 20%거짜리 part로book она 20%거짜리 part로book она 20%거짜리 part로book 내가 못 잡지 값 더heart 더 über 다

schu fore od 어 그리고 uh museum comeibles over 예전에 어디 뉴스 보니까 정부에서 데이터 땜 사업 이런 산업을 진행하겠다 그런데 과연 좋은 생각일까 어쨌든 이것도 이제 일거리는 일거리인데 이게 약간 한국에 맞는 일자리인가

이런 생각은 좀 들어요

미국 같은 데 보면 이런 거를 다 외주를 해외에 주거든요

그래서 아프리카 이런 데다가 다 외주를 줍니다

임금이 싸니까 아프리카 영어 통하는 나라 이런 데서 그런 데는 제조업 기관이 없으니까 이런 거 레이블링 하는 거는 컴퓨터가 있으면 되잖아요

컴퓨터 사양이 좋을 필요도 없고 그래서 이제 약간 웃지 못할 일 중에 하나가 채찍 PT한테 영어로 뭘 써보라고 하면 델브라는 단어를 되게 많이 쓰거든요

채찍 PT가 델브라는 단어를 되게 많이 쓰는데 아주 많이 쓰는 건 아닌데 묘하게 델브라는 단어를 일반인들보다 많이 써요

왜 그러냐면 델브라는 단어가 아프리카 옛날 영국 식민지에서 많이 쓰는 단어입니다

그래서 그게 하나의 증거가 되는 거죠

채찍 PT 데이터는 아프리카 영국 식민지에서 많이 만들었다 왜냐면 얘가 미국 사람들보다 미국 사람들은 델브를 잘 안 쓰는데 그래서 실제로 채찍 PT 공개 이후에 델브라는 단어의 빈도가 해외 학술지 논문에서 굉장히 증가했습니다

이걸 보면 사람들이 논문 쓸 때 채찍 PT로 쓰는구나 이거를 알 수 있죠

그래서 우리가 레이블링 같은 거는 사실 한국에서 시키려면 임금이 비싸니까 한국은 사실 좀 생산성이 있는 게 아니고 양이 적으면 상관없는데 양이 많으면은 이런 것도 약간 글로벌하게 인도에다가 외주를 주든지 이렇게 됩니다

우리가 이제 보통 그 정도로 어디 막 해외에다 외주할 정도로 데이터가 많이 필요한 적은 없으니까 국내에다가 해도 충분하긴 합니다

어쨌든 여기까지 다 해보셨죠?

그래서 이제 여기에 있는 파일 이름에 있는 이미지를 다 불러와야 되는데 400조 그래서 이 코드는 여기 annotation result에 이메일을 불러야 되는데 400조는 이렇게 되거든요.

그래서 이 코드는 여기 annotation result에 이메일을 불러야 되는데 400조는 이렇게 되거든요.

그래서 이 코드는 여기 annotation result에 이메일을 불러야 되는데 400조는 이렇게 되거든요.

그런데 image에 들어가서 여기 상단에 image에 들어가서 여기 있는 이미지 파일들을 다 불러오는 그런 역할을 합니다.

그래서 다 불러오고 그다음에 이제 여기 하단에 있는 오브젝트가 다 따로 있는데 오브젝트 1,2,3,4 따로 있는데 여기 이제 image id가 보면 오브젝트 id 0번은 image id가 0번이고 object id1번은 image id가 0번이고 그럼 얘네 2개는 image id 0번 밑에다가 이렇게 끼워 넣어주는 코드에요.

그래서 이거를 실행을 해주시고 아직 안 깨워놓았군요

틀만 만들어놨고 그 다음에 401쪽에 있는 코드는 그래서 어노테이션즈에 있는 거를 이미지 아이디를 보고 이미지 아이디가 0번이면 0번 이미지에다 갖다 추가해주고 1번이면 1번 이미지에다 추가해주고 그래서 여기까지 하신 다음에 이미지즈 해보면 0번은 이미지 아이디가 0번이고 이미지는 이거고 위스는 이거고 하이트는 이거 오브젝트는 이거 삐빡스는 이거 이렇게 쪼로록 정리가 되어있습니다

그래서 아까 우리가 이제 예제 데이터 가지고 했을 때는 전처리가 좀 길었거든요

기억나실지 모르겠지만 지금은 불러와서 전처리가 그렇게 많지 않습니다

왜냐면 애초에 데이터 포맷을 코코 형식으로 했으니까 그래서 조금 손이 더는 거죠

다른 포맷으로 하셔도 되는데 그러면 변환을 직접 하셔야 됩니다

그래서 이제 학습을 하시려면 데이터셋을 만들어야 되는데 데이터셋을 만드시려면 데이터셋.fromlist 해가지고 list.image.values 하면은 여기 보시는 이 목록들을 리스트 형태로 해서 데이터셋으로 만들어주고요 그 다음에 우리가 아까 만들어놓은 전처리 한 번에 이 단수 중에 org.ann 이라고 있는데 이거를 일괄 적용을 해주시면은 데이터셋이 준비가 됩니다

그래서 데이터셋이 준비가 됐으면 우리 아까 이제 오브젝트 디텍션 모델 학습을 시킬 때 여기 모델 다운받고 트레이닝.arg 설정하고 그 다음에 트레이닝 시키고 이거 있는데 여기서 이제 모델 설정하고 트레이닝.arg 하고 여기까지 똑같은데 여기 트레인 데이터셋에다가 우리가 지금 만든 데이터가 ds죠

고급만 ds로 바꿔주시면 돼요

모델 아까랑 똑같이 하시고 트레이닝.arg 똑같이 하시고 그 다음에 트레이닝 똑같이 하시는데 이게 이제 실수하기 쉬운 건데 이래놓고 이제 데이터를 이걸로 하시면은 지금까지는 여기까지입니다.

그래서 데이터를 더 모아서 돌려봤는데 저번 보다 성능이 70% 정도였는데 이번에는 80%였다

그러면 좀 데이터를 더 모아야 될 것 같죠

데이터를 더 모아서 해봤는데 그 다음에 81% 밖에 안되더라

그러면은 아 왠지 약간 고점이다

이렇게 생각할 수 있겠죠

그래서 성능 향상폭이 거의 없을 때까지 데이터를 늘려주시면 됩니다

이렇게 어떤거요?

이거는 그 앞에 했던 모델 불러오고 트레이닝 아드 설정하고 그 다음에 트레이너 트레인 하는데 여기 데이터셋만 ds 로 바꿔주시면 됩니다

tu 그 다음에 지금 자동 저장이 계속 안되는데 자동 저장이 안되면 수동으로 저장하시면 되거든요

그래서 모델점 세이브 프리트레인드 해가지고 저장하실 이름을 태권부위 철자가 틀렸네요

이렇게 써주시면은 여기 보시면은 태권부위라고 폴더가 생기죠

이 폴더에 저장이 되구요

여기 들어가보면 config랑 모델점 세이브 텐서 이렇게 저장이 되어있습니다

그래서 저장은 수동으로 저장하시려면 이렇게 하면 되고 지금 이유를 모르겠는데 계속 자동 저장이 안되서 어차피 모델은 있으니까 수동 저장 하시면 되구요

불러올때는 어떻게 하면 되냐면 원래 우리가 오토 모델 뭐 이렇게 하잖아요

오토 모델 이렇게 하는데 원래는 여기에다가 이제 그 아이디랑 페이스북 뭐 이렇게 썼거든요

어디갔죠

모델 불러오는거 요거죠

그래서 여기에 이제 체크 포인트에 원래는 오리지널 모델 이름이 들어가는데 우리 저장을 해 주셨으면 그 저장한 그 위치를 이렇게 써주시면 됩니다

모델 2는 이렇게 해가지고 하면은 우리가 이제 저장한 수동 저장한 모델을 불러올 수 있습니다

수동 저장 했을 때 그 이름으로 그대로 하시면 다시 불러올 수 있어요

자동 저장 됐을 때도 마찬가지인데 어쨌든 저장된 데에 위치를 써주시면 거기서 불러옵니다

네 네 네 이게 지금 원래는 여기 트레인을 하면 트레인을 하면은 트레이닝 다 끝나고 나서 자동으로 저장을 해주거든요

네 네 앞에 모델 그거 붙여 놓아가지고 아 요기요 요거는 제가 페이지를 알려드릴게요

아 아 어디냐 하면 여기 트레인 데이터셋을 디디에 넣어서 아 아 여기 원래 트레인 데이터셋 보시면 강의자료 cpp 트레인이 이렇게 돼 있는데 있잖아요

잠깐만요 여기 있다

cpp 트레인 저거 아닙니다

아 이거는 저거 classification이네요

386 4 5 6인데 요게 데이터셋 이름이거든요

아 우리가 만든 데이터가 ds니까 요거만 ds로 바꿔줄 수 있네요

요거 3페이지 다 복사할 거 같으시고 자 가볍게 네 네 네 네 네 네 네 네 네 네 네 네 아 아 아 아 아 아 자동 저장이 안되면 수동으로 저장을 하시면 됩니다.

여기 이렇게 save pre trained 한 다음에 아무 이름이나 쓰시면 됩니다.

그러면 지금 작업하고 있는 데다가 이 폴더가 생기면서 그 폴더에 자동으로 저장이 돼요.

저장을 해주셨다가 다음번에 이거 쓰실 일이 있을 거 아니에요.

트레이닝 시켰으니까.

트레이닝 몇 시간씩 걸려서 시켰으면 저장해 놓은 걸 불러와야겠죠.

원래는 모델 불러올 때랑 똑같이 하시면 되는데 근데 이게 원래는 페이스북 DETR 어쩌고 그게 플레이로 들어가는데 플레이로 그거는 온번이고 우리가 미세먼지 조정을 해 놓은 이름을 저장해 놓은 걸 이름으로 써주시면 그걸 불러올 수가 있어요.


```python copy
import json
annotation_result = json.load(open("result.json"))
```



```python copy
images = {}
for image_dict in annotation_result['images']:
    images[image_dict['id']] = {
        'image_id': image_dict['id'],
        'image': Image.open(image_dict['file_name']),
        'width': image_dict['width'],
        'height': image_dict['height'],
        'objects': {'id': [], 'area': [], 'bbox': [], 'category': []}
    }

```



```python copy
for annotation_dict in annotation_result['annotations']:
    image_id = annotation_dict['image_id']
    objects = images[image_id]['objects']
    objects['id'].append(annotation_dict['id'])
    objects['area'].append(annotation_dict['area'])
    objects['bbox'].append(annotation_dict['bbox'])
    objects['category'].append(annotation_dict['category_id'])

```



```python copy
images
```

:::info[output]
```
{0: {'image_id': 0,
  'image': <PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=662x492>,
  'width': 662,
  'height': 492,
  'objects': {'id': [0, 1, 2, 3],
   'area': [87355.45998224163,
    93562.29529676934,
    63914.59206338369,
    49496.63809849051],
   'bbox': [[235.25619834710741,
     17.507438016528923,
     210.08925619834707,
     415.801652892562],
    [39.39173553719008,
     102.85619834710744,
     242.91570247933885,
     385.16363636363633],
    [370.93884297520657,
     126.92892561983473,
     175.07438016528934,
     365.0710743801653],
    [515.3752066115702,
     118.17520661157026,
     142.24793388429745,
     347.96033057851236]],
   'category': [1, 0, 0, 0]}},
 1: {'image_id': 1,
  'image': <PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=665x494>,
  'width': 665,
  'height': 494,
  'objects': {'id': [4, 5, 6, 7],
   'area': [74601.56990358127,
    66654.707274382,
    49267.21597295951,
    52381.46464646465],
   'bbox': [[225.48106060606057,
     65.49242424242424,
     198.34848484848487,
     376.1136363636363],
    [118.82196969696969,
     166.5378787878788,
     203.97295685970417,
     326.7820808237249],
    [351.79871443546176,
     196.47727272727272,
     165.59143707968974,
     297.52272727272725],
    [465.9318181818182,
     174.02272727272728,
     174.95833333333331,
     299.39393939393943]],
   'category': [1, 0, 0, 0]}},
 2: {'image_id': 2,
  'image': <PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=916x579>,
  'width': 916,
  'height': 579,
  'objects': {'id': [8, 9, 10, 11],
   'area': [105555.62657925722,
    113497.67471960942,
    44797.662826591964,
    107783.85040984536],
   'bbox': [[282.7100213219617,
     23.456289978678043,
     239.50106609808103,
     440.7313432835821],
    [27.15991471215352,
     170.36673773987204,
     297.5245202558636,
     381.47334754797447],
    [459.2494669509595,
     146.91044776119404,
     164.19402985074623,
     272.83368869936027],
    [582.7036247334756,
     145.67590618336888,
     320.9808102345416,
     335.7953091684434]],
   'category': [1, 0, 0, 0]}},
 3: {'image_id': 3,
  'image': <PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=631x488>,
  'width': 631,
  'height': 488,
  'objects': {'id': [12, 13, 14, 15],
   'area': [89187.82552800734,
    56611.136822773165,
    55292.31523536501,
    46715.4848633678],
   'bbox': [[202.40906779690258,
     61.92424242424247,
     229.2121212121212,
     389.1060606060606],
    [13.86363636363636,
     141.4090909090909,
     201.48484848484844,
     280.96969696969694],
    [331.8028916298999,
     246.77271509296534,
     229.2125256754178,
     241.22728490703466],
    [478.75715973818507,
     181.15151515151499,
     152.2428402618149,
     306.84848484848476]],
   'category': [1, 0, 0, 0]}},
 4: {'image_id': 4,
  'image': <PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=646x497>,
  'width': 646,
  'height': 497,
  'objects': {'id': [16, 17, 18, 19],
   'area': [71148.5225443354,
    54008.41010961889,
    56085.247718663915,
    48469.93462680789],
   'bbox': [[246.6174242424242,
     63.06628787878788,
     200.49431818181816,
     354.8655303030303],
    [93.1875, 181.6685606060606, 184.4924242424242, 292.74053030303025],
    [355.8068181818181,
     213.67234848484847,
     198.61174242424244,
     282.3863636363636],
    [488.52840909090895,
     157.19507575757575,
     157.47159090909102,
     307.8011363636364]],
   'category': [1, 0, 0, 0]}}}
```

:::



```python copy
from datasets import Dataset
ds = Dataset.from_list(list(images.values()))
ds = ds.with_transform(transform_aug_ann)

```



```python copy
from transformers import AutoModelForObjectDetection

model = AutoModelForObjectDetection.from_pretrained(
    checkpoint,
    id2label=id2label,
    label2id=label2id,
    ignore_mismatched_sizes=True,
)

from transformers import TrainingArguments
training_args = TrainingArguments(
    output_dir="C:/detr-resnet-50_finetuned_cppe5",  # 저장할 디렉토리
    per_device_train_batch_size=8,
    num_train_epochs=1,  # 에포크
    fp16=False, # GPU가 mixed precision을 지원하면 True로
    save_steps=200,
    logging_steps=50,
    learning_rate=1e-5,
    weight_decay=1e-4,
    save_total_limit=2,
    remove_unused_columns=False,
    push_to_hub=False,
)

from transformers import Trainer
import numpy as np

trainer = Trainer(
    model=model,
    args=training_args,
    data_collator=collate_fn,
    train_dataset=ds,
    processing_class=image_processor,
)

trainer.train()

```



```python copy
model.save_pretrained('tawkwonv') # 수동 저장
```



```python copy
model2 = AutoModelForObjectDetection.from_pretrained(
    'tawkwonv',
    id2label=id2label,
    label2id=label2id,
    ignore_mismatched_sizes=True,
)
```

 */}
