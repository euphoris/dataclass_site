# 복잡한 대시보드

## 사이드바
```python
with st.sidebar:
 st.markdown('# 사이드바 제목')
 st.markdown('사이드바 내용 작성')
```

## 탭
```python
tab1, tab2 = st.tabs(["고양이", "강아지"])

with tab1:
 st.header("고양이")
 st.image("https://static.streamlit.io/examples/cat.jpg", width=200)

with tab2:
 st.header("강아지")
```

## 화면 분할
```python
left_column, right_column = st.columns(2) # 좌우 2개 컬럼으로

with left_column: # 왼쪽 컬럼에 들어갈 내용
 st.markdown('왼쪽')

with right_column: # 오른쪽 컬럼에 들어갈 내용
 st.markdown('오른쪽')
```

## 페이지
* 대시보드를 여러 개의 페이지로 나눌 수 있음
* 페이지 별로 별개의 파일 또는 함수로 구현
* `page_1.py`:
```python
import streamlit as st
st.title("Page 1")
```
* `main.py`:
```python
import streamlit as st

def page_2():
 st.title("Page 2")

pg = st.navigation(["page_1.py", page_2])
pg.run()
```

## 인터랙션
* 사용자의 입력에 따라 다른 결과를 제시
```python
model = st.selectbox('차종', options=['전체', 'Avante', 'K3'])
if model == '전체':
 st.write('## 전체 차종의 가격 분포')
 ax = sns.boxplot(y='price', data=df)
else:
 st.write(f'## {model} 차종의 가격 분포')
 ax = sns.boxplot(y='price', data=df[df['model'] == model])
st.write(ax.figure) # 차트의 그림(figure)
```
* https://docs.streamlit.io/develop/api-reference/widgets 참고

## 캐시
* streamlit은 코드를 수정할 때마다 화면을 새로 그리므로, 오래 걸리는 계산이 있을 경우 비효율적
* 계산 결과를 캐시(cache, 임시 저장 공간)에 저장하면 같은 계산을 반복하지 않으므로 효율적
* streamlit의 캐시 종류:
    * `cache_data`: 일반적인 계산 결과나 데이터(데이터베이스에 저장할 수 있음)
    * `cache_resource`: 용량이 매우 많거나, 데이터베이스에 저장할 수 없는 머신러닝 모델, 데이터베이스 연결 등

## cache_data
```python
@st.cache_data # 실행 결과를 캐시에 저장
def load_data(url): # 인터넷에서 데이터를 불러오는 함수(오래 걸림)
 df = pd.read_csv(url)
 return df

if st.button('데이터 불러오기'): # 처음엔 다운받아 느리지만, 다음에는 캐시에서 로딩해서 빠름
 df = load_data("https://github.com/plotly/datasets/raw/master/uber-rides-data1.csv")
 st.dataframe(df)
```
* 옵션
    * `@st.cache_data(ttl=3600)`: 유효기간 1시간(3600초)
    * `@st.cache_data(max_entries=1000)`: 최대 1000개의 결과만 캐싱
    * `@st.cache_data(show_spinner="진행 중...")`: 대기 문구 설정

## 대시보드 상태의 지속성 문제
* `counter.py`:
```python
import streamlit as st

count = 0
increment = st.button('증가')

if increment:
 count += 1

st.write('Count = ', count)
```
* "증가" 버튼을 눌러도 1까지만 증가하고 더 증가하지 않음
* 버튼을 누를 때마다 처음부터 코드를 다시 실행하기 때문

## 세션 상태
* 처음부터 다시 실행해도 세션 상태는 보존
```python
import streamlit as st

if 'count' not in st.session_state: # 세션 상태에 'count'가 없으면
 st.session_state.count = 0

if st.button('증가'):
 st.session_state.count += 1

st.write('Count = ', st.session_state.count)
```


## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="complex-dashboard" quizItems={
[
    {
        "item_type": "radio",
        "question": "Streamlit에서 웹 페이지의 기본 콘텐츠 영역이 아닌, 별도의 측면 패널에 제목이나 위젯을 배치하고 싶을 때 사용하는 구문은 무엇입니까?",
        "options": [
            "with st.sidebar:",
            "with st.panel:",
            "with st.aside:",
            "with st.columns(1):"
        ],
        "hint": "'사이드바'를 의미하는 영어 단어를 사용합니다.",
        "solution": "with st.sidebar:"
    },
    {
        "item_type": "radio",
        "question": "Streamlit 화면을 두 개의 세로 컬럼(열)으로 분할하여 왼쪽과 오른쪽에 각각 다른 콘텐츠를 배치하려고 합니다. 올바른 코드는 무엇입니까?",
        "options": [
            "st.split(2)",
            "st.columns(2)",
            "st.divide(2)",
            "st.layout(2)"
        ],
        "hint": "'컬럼' 또는 '열'을 의미하는 영어 단어를 사용합니다.",
        "solution": "st.columns(2)"
    },
    {
        "item_type": "radio",
        "question": "사용자가 드롭다운 메뉴에서 여러 차종('전체', 'Avante', 'K3') 중 하나를 선택하도록 하는 인터랙티브 위젯을 만들 때 가장 적합한 함수는 무엇입니까?",
        "options": [
            "st.button()",
            "st.radio()",
            "st.selectbox()",
            "st.slider()"
        ],
        "hint": "여러 옵션 중 하나를 '선택하는 상자(select box)'를 만드는 함수입니다.",
        "solution": "st.selectbox()"
    },
    {
        "item_type": "radio",
        "question": "Streamlit 앱에서 `@st.cache_data` 데코레이터를 사용하는 주된 목적은 무엇입니까?",
        "options": [
            "데이터를 영구적으로 데이터베이스에 저장하기 위해",
            "시간이 오래 걸리는 함수의 계산 결과를 임시 저장하여 반복 실행을 피하고 앱 속도를 높이기 위해",
            "사용자의 입력 값을 자동으로 검증하기 위해",
            "코드의 보안을 강화하기 위해"
        ],
        "hint": "앱이 새로고침될 때마다 비효율적인 계산을 반복하지 않도록 도와줍니다.",
        "solution": "시간이 오래 걸리는 함수의 계산 결과를 임시 저장하여 반복 실행을 피하고 앱 속도를 높이기 위해"
    },
    {
        "item_type": "radio",
        "question": "Streamlit 앱에서 버튼을 누를 때마다 스크립트가 처음부터 다시 실행되어 변수 값이 초기화되는 문제가 있습니다. 사용자의 상호작용에 걸쳐 'count'와 같은 변수의 값을 유지하고 싶을 때 사용해야 하는 기능은 무엇입니까?",
        "options": [
            "st.cache_data",
            "st.secrets",
            "st.session_state",
            "st.variable"
        ],
        "hint": "사용자 한 명의 '세션' 동안 상태(state)를 저장하는 기능입니다.",
        "solution": "st.session_state"
    },
    {
        "item_type": "radio",
        "question": "세션 상태(session state)에 저장된 'count'라는 변수의 값을 1 증가시키려고 합니다. `____.count += 1` 코드의 빈칸에 들어갈 올바른 코드는 무엇입니까?",
        "hint": "st 라이브러리의 세션 상태 객체를 가리켜야 합니다.",
        "options": [
            "st.session_state",
            "st.state",
            "st.cache_data",
            "st.variable"
        ],
        "solution": "st.session_state"
    }
]
} />


## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>