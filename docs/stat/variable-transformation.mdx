# 변수의 변형
## 변수의 변형

*   **필요성:** 선형 모형은 독립-종속 변수 간 **선형 관계 가정**. 현실 데이터는 비선형 관계 많음.
*   **방법:** 독립변수(또는 종속변수)에 **비선형 함수(로그, 제곱근, 제곱 등) 적용**하여 관계 선형화 시도.
*   **예시:** $z = \log x$, $\hat{y} = wz + b$
*   **Python:** 관계식 내 `numpy` 등 수학 함수 직접 사용 가능 (`np.log(x)`).

## 로그 함수 변환

*   **형태:** 오른쪽 위로 갈수록 완만해짐 (증가율 감소).
*   **특성:** 큰 값 차이 줄여줌 (예: 1 vs 10, 10 vs 100, 100 vs 1000 이 로그 스케일에서는 등간격).
*   **효과:** 데이터 오른쪽 긴 꼬리(positive skew) **왼쪽으로 끌어당겨 분포 대칭적으로 만듦**.
*   **용도:** 소득, 가격 등 **오른쪽으로 치우친(positive skewed)** 변수 변환에 자주 사용. 간격 일정하게 만드는 효과.

## 왜도

*   데이터 분포의 **비대칭 정도**.
    *   `Negative Skew`: 왼쪽 꼬리 김 (- 방향 치우침). 평균 < 중간값 < 최빈값.
    *   `Positive Skew`: 오른쪽 꼬리 김 (+ 방향 치우침). 최빈값 < 중간값 < 평균.
*   **값 해석 (절대값 기준):**
    *   `0`: 좌우 대칭.
    *   `|0.5|`: 중간 정도 치우침.
    *   `|1|`: 극단적 치우침.

## 예시: 중고차 주행거리 분포

*   **히스토그램:** 오른쪽 꼬리 긴 형태 보임.
*   **왜도 계산:** `skew(df['mileage'])` 결과 > 1.04 → **+ 방향 매우 치우침**.
*   **로그 변환:** `np.log(mileage)` 적용 시 분포 좀 더 대칭적으로 변함. 회귀 분석 성능 개선 기대.

## Python 로그 함수 적용

회귀분석

```python
import numpy as np
from statsmodels.formula.api import ols
m = ols('price ~ np.log(mileage)', data=df).fit()
```
산점도 (x축도 로그 변환)
```python
import matplotlib.pyplot as plt
plt.plot(np.log(df.mileage), df.price, 'o') # 'o'는 점 모양
```
{/*
## Box-Cox 변환

```python
from scipy.stats import boxcox
df['mileage_tr'], lambd = boxcox(df.mileage)
```

회귀 분석
```python
ols('price ~ mileage_tr', data=df).fit().summary()
```

변환 함수의 시각화

```python
# 변환 함수의 플롯
import matplotlib.pyplot as plt
x = np.linspace(0, 200000, 100)
y = boxcox(x, lambd)
plt.plot(x, y)
```
*/}

## 독립변수의 서열(순위) 이용 회귀분석

*   **방법:** 독립변수 실제 값 대신 **순위(rank)** 사용.
*   **관계식:** `y ~ x.rank()`
*   **논리:** 스피어만 상관계수와 유사. 변수 간 **단조적 관계** 파악.
*   **장점:**
    *   표준화처럼 단위 다른 변수 비교 용이.
    *   로그 변환처럼 한쪽으로 치우친 데이터 영향 완화. 비선형성 일부 처리.
*   **단점:**
    *   새로운 데이터 예측 시, 기존 데이터 기준 순위 다시 매겨야 함 (번거로움).
    *   관찰 범위 벗어난 값 예측 불가 (순위 기반이므로).

## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="variable-transformation" quizItems={
[
    {
        "item_type": "radio",
        "question": "회귀분석에서 변수 변환을 수행하는 주된 이유는 무엇인가요?",
        "options": [
            "모든 변수의 단위를 통일하여 계수 비교를 용이하게 하기 위해",
            "독립변수와 종속변수 간의 관계가 선형 모형의 기본 가정(선형성)에 더 잘 부합하도록 만들기 위해",
            "데이터의 개수를 늘려 모형의 안정성을 높이기 위해",
            "결정계수(R-squared) 값을 항상 1에 가깝게 만들기 위해"
        ],
        "hint": "회귀분석에서 변수 변환은 비선형 모형으로 분석해야 하는 데이터를 어느 정도 범위에서 선형 모형으로 분석할 수 있도록 돕는 역할을 합니다.",
        "solution": "독립변수와 종속변수 간의 관계가 선형 모형의 기본 가정(선형성)에 더 잘 부합하도록 만들기 위해"
    },
    {
        "item_type": "radio",
        "question": "로그 변환에 대한 설명으로 가장 적절한 것은 무엇인가요?",
        "options": [
            "데이터 분포의 왼쪽 꼬리가 긴 경우(Negative Skew) 이를 완화하는 데 주로 사용된다.",
            "변수의 값을 항상 양수로 만들어 음수 값 문제를 해결한다.",
            "큰 값들 사이의 차이를 줄여주어, 오른쪽으로 치우친(Positive Skew) 분포를 더 대칭적으로 만드는 경향이 있다.",
            "변환 후에는 모든 변수의 평균이 0, 표준편차가 1이 된다."
        ],
        "hint": "로그 함수는 밑이 10인 경우 1, 10, 100에 대해 각각 0, 1, 2의 값을 갖습니다.",
        "solution": "큰 값들 사이의 차이를 줄여주어, 오른쪽으로 치우친(Positive Skew) 분포를 더 대칭적으로 만드는 경향이 있다."
    },
    {
        "item_type": "radio",
        "question": "어떤 데이터의 왜도(Skewness) 값이 +1.5로 계산되었습니다. 이 데이터 분포의 특징으로 가장 올바른 설명은 무엇인가요?",
        "options": [
            "분포가 왼쪽으로 극단적으로 치우쳐 있다.",
            "분포가 거의 좌우 대칭에 가깝다.",
            "분포가 오른쪽으로 상당히 치우쳐 있으며, 평균값이 중앙값보다 클 가능성이 높다.",
            "데이터 값들이 평균을 중심으로 매우 넓게 퍼져 있다 (분산이 크다)."
        ],
        "hint": "왜도는 데이터 분포의 비대칭 정도를 나타내는 지표입니다.",
        "solution": "분포가 오른쪽으로 상당히 치우쳐 있으며, 평균값이 중앙값보다 클 가능성이 높다."
    },
    {
        "item_type": "radio",
        "question": "독립변수의 실제 값 대신 순위(rank)를 사용하여 회귀분석(`y ~ x.rank()`) 수행하는 방법의 장점으로 보기 **어려운** 것은 무엇인가요?",
        "options": [
            "단위가 다른 변수들의 상대적 영향력을 비교하는 데 도움이 될 수 있다.",
            "극단값(outlier)이나 치우친 분포의 영향을 완화할 수 있다.",
            "변수 간의 단조적(monotonic) 비선형 관계를 어느 정도 포착할 수 있다.",
            "새로운 데이터에 대한 예측값을 쉽게 계산할 수 있다."
        ],
        "hint": "순위의 경우 기존 데이터의 순위를 기반으로 하므로, 새로운 데이터에 대한 순위를 매기는 과정이 필요하다.",
        "solution": "새로운 데이터에 대한 예측값을 쉽게 계산할 수 있다."
    },
    {
        "item_type": "number",
        "question": "wordrecall.xlsx 파일에서 `prop ~ time`으로 회귀분석을 해보세요. R제곱은 얼마입니까? (소수점 셋째 자리까지)",
        "tolerance": 0.001,
        "hint": "```\nwr = pd.read_excel(\'wordrecall.xlsx\')\nols(\'prop ~ time\', data=wr).fit().summary()\n```",
        "solution": 0.571
    },
    {
        "item_type": "number",
        "question": "위의 분석에서 `time`에 로그 함수를 적용하여 회귀분석을 해보세요. R제곱은 얼마입니까? (소수점 셋째 자리까지)",
        "tolerance": 0.001,
        "hint": "```\nols(\'prop ~ np.log(time)\', data=wr).fit().summary()\n```",
        "solution": 0.990
    },
    {
        "item_type": "radio",
        "question": "위의 두 회귀분석 결과를 비교했을 때, 어떤 쪽의 분석이 더 적합하다고 볼 수 있나요?",
        "options": [
            "원래 변수 값을 사용한 분석이 더 적합하다.",
            "로그 변환을 적용한 분석이 더 적합하다.",
            "두 분석 결과는 비슷하므로 특별한 차이가 없다."
        ],
        "hint": "두 분석의 적합도 지수를 비교하여 더 나은 분석을 선택하세요.",
        "solution": "로그 변환을 적용한 분석이 더 적합하다."
    }
]
} />

## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>