# 상관 분석

## 상관 계수 정의

*   **두 변수**의 **선형적 연관성** 정도를 **-1 ~ +1** 범위 수치로 나타낸 값.
*   두 변수 연관성 파악 위해 사용.
    *   예: 어휘력-독해력, 주가-금 가격, 엔진 성능-고객 만족도 관계.

## 상관계수 해석

*   **부호 (Direction):**
    *   `+`: 양의 상관. 두 변수 **같은 방향** 변화 (하나 증가 시 다른 하나도 증가).
    *   `-`: 음의 상관. 두 변수 **반대 방향** 변화 (하나 증가 시 다른 하나는 감소).
*   **크기 (Strength):** 절대값 기준.
    *   `0`: **선형 관계 없음**. 한 변수 변화로 다른 변수 변화 예측 불가 (독립일 수 있음).
    *   `1` (또는 -1): **완벽한 선형 관계**. 한 변수 변화로 다른 변수 변화 정확히 예측 가능.

## 기울기 vs. 상관계수

*   **기울기 (Slope):** 직선 방정식 `y = ax + b` 에서 `a`.
    *   `x`가 1만큼 변할 때 `y`의 **변화량**.
    *   기울기 클수록 `x` 변화에 따른 `y` 변화 **크기** 큼.
*   **상관계수:** 두 변수 간 선형 관계의 **밀접성**(데이터가 직선 주위에 얼마나 모여 있는지).
*   **둘은 다른 개념.** 기울기 크기와 상관계수 크기는 직접 관련 없음.
    *   기울기 커도 데이터 흩어져 있으면 상관계수 낮을 수 있음.
    *   기울기 작아도 데이터 직선에 가깝게 모여 있으면 상관계수 높을 수 있음.


## 공분산 (Covariance)

*   X의 편차(X - X̄)와 Y의 편차(Y - Ȳ)를 곱한 것의 평균 (표본 공분산은 N-1로 나눔).

$$
\text{cov}(X,Y) = \frac{\sum(X_i - \bar{X})(Y_i - \bar{Y})}{N - 1}
$$


*   **해석:**
    *   `+` 값: 두 변수 같은 방향 변화 경향 (우상향).
    *   `-` 값: 두 변수 반대 방향 변화 경향 (우하향).
*   **단점:** 단위에 따라 값 크기 달라져 해석 어려움. (예: 키(cm)와 몸무게(kg) 공분산 vs 키(m)와 몸무게(kg) 공분산)

## 피어슨 적률 상관계수 (Pearson Correlation Coefficient, r)

*   가장 대표적인 상관계수. 보통 '상관계수'라고 하면 피어슨 상관계수 의미.
*   **계산:** 공분산을 각 변수의 **표준편차 곱**으로 나눈 값.

$$
r = \frac{\text{cov}(X, y)}{\sigma_X, \sigma_Y}
$$

*   **결과:** 단위 영향 제거. 항상 **-1 ~ +1 범위** 값 가짐.
*   **측정 대상:** 두 변수 간의 **선형적** 관계 강도.

## 상관계수와 비선형 관계

*   (피어슨) 상관계수는 **선형적** 관계(우상향 또는 우하향 직선 관계)만 잘 표현함.
*   복잡한 **비선형(곡선) 관계**는 잘 나타내지 못함.
*   **주의:** 상관계수 낮다(0에 가깝다)고 해서 **두 변수 간 아무 관계도 없는 것은 아님**. 비선형 관계 있을 수 있음.


## 상관분석 가설검정

*   **귀무가설 (H₀):** 모집단에서 상관계수 = 0 (두 변수 간 선형 관계 없음).
*   **대립가설 (H₁):** 모집단에서 상관계수 ≠ 0 (두 변수 간 선형 관계 있음).
*   **판단:** p-value < 유의수준 (α) 이면 귀무가설 기각. 통계적으로 유의한 상관관계 있다고 판단.


## 상관계수의 신뢰구간

*   모집단 상관계수가 존재할 것으로 추정되는 범위.
*   **해석:**
    *   `+ ~ +`: 모집단에서 양(+)의 상관관계 추정.
    *   `- ~ +`: 신뢰구간에 0 포함. 모집단 관계가 양, 음, 0 모두 가능성 있음 (통계적으로 유의하지 않음).
    *   `- ~ -`: 모집단에서 음(-)의 상관관계 추정.

## 상관계수 크기 해석 기준 (주의 필요)

*   Cohen(1988) 등의 권장 기준 (엄밀한 근거 기반 아님, 참고용):
    *   낮음: ~ 0.1
    *   중간: 0.1 ~ 0.5
    *   높음: 0.5 ~
*   **실제 활용:** 절대 기준보다 **상대적 비교**가 더 바람직.
    *   예: 고객 만족도와 상관 0.2인 요소 A, 0.3인 요소 B 중 하나 선택해야 한다면, 상관 더 높은 B 고려.

## Python 상관 분석

```python
import pingouin as pg

# price와 mileage 간 상관분석 수행
pg.corr(df.price, df.mileage)
```

*   **결과 해석:**
    *   `r`: 표본 상관계수.
    *   `CI95%`: 95% 신뢰구간.
    *   `p-val`: p-value.

## Python 상관 행렬

```python
# 데이터프레임 df에서 연속형 변수들 간 상관계수 행렬 구하기
df.corr(numeric_only=True) # numeric_only=True: 숫자형 열만 선택
```

*   결과: 각 변수 쌍 간 상관계수를 표(행렬) 형태로 보여줌.

## 산점도 (Scatter Plot)

*   두 연속형 변수 간 관계 시각화하는 가장 기본적인 그래프.
*   점으로 데이터 분포, 관계 형태(선형/비선형), 방향, 강도 파악 도움.
```python
import seaborn as sns

# mileage(x축)와 price(y축) 간 산점도 그리기
sns.scatterplot(x='mileage', y='price', data=df)
```

## 현대 포트폴리오 이론 (Modern Portfolio Theory, MPT)

*   (해리 마코위츠, 1952) 금융 자산 투자 이론. 상관계수 개념 중요하게 활용.
*   **핵심:** 개별 자산 수익률뿐 아니라 **자산 간 상관관계** 가 포트폴리오 전체 위험에 영향 줌.
*   **원리:** 상관관계 **낮은** 자산들로 포트폴리오 구성하면, 개별 자산 위험 합보다 **전체 포트폴리오 위험 낮출 수 있음** (분산 투자 효과). 동일 기대 수익률에서 더 낮은 위험 달성 가능.


## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="correlation" quizItems={
[
    {
        "item_type": "radio",
        "question": "상관 계수에 대한 설명으로 가장 적절한 것은 무엇입니까?",
        "options": [
            "두 변수 간의 인과 관계를 명확히 밝혀주는 지표이다.",
            "두 변수가 얼마나 관계를 갖는지 -1에서 +1 사이 값으로 나타낸다.",
            "상관계수는 그래프의 기울기를 나타낸다",
            "한 변수의 단위가 바뀔 때 다른 변수가 얼마나 변하는지를 나타내는 값이다."
        ],
        "hint": "상관 계수는 두 변수 간의 선형 관계를 -1에서 +1 사이의 값으로 나타냅니다.",
        "solution": "두 변수가 얼마나 관계를 갖는지 -1에서 +1 사이 값으로 나타낸다.",
    },
    {
        "item_type": "checkbox",
        "question": "상관계수 값에 대한 해석으로 옳은 것을 **모두** 고르세요.",
        "options": [
            "상관계수가 +0.8이면 두 변수는 강한 양의 선형 관계를 가진다.",
            "상관계수가 -0.2이면 두 변수는 약한 음의 선형 관계를 가진다.",
            "상관계수가 0이면 두 변수 간에는 어떠한 관계도 존재하지 않는다.",
            "상관계수가 -1이면 한 변수가 증가할 때 다른 변수는 정확히 예측 가능한 비율로 감소한다."
        ],
        "hint": "상관계수가 0이면 선형 관계가 없음을 의미합니다.",
        "solution": [
            "상관계수가 +0.8이면 두 변수는 강한 양의 선형 관계를 가진다.",
            "상관계수가 -0.2이면 두 변수는 약한 음의 선형 관계를 가진다.",
            "상관계수가 -1이면 한 변수가 증가할 때 다른 변수는 정확히 예측 가능한 비율로 감소한다."
        ],
    },
    {
        "item_type": "checkbox",
        "question": "직선의 기울기와 상관계수에 대한 설명 중 옳은 것을 **모두** 고르시오.",
        "options": [
            "기울기가 크면 상관계수의 절대값도 항상 크다.",
            "상관계수의 절대값이 크면 기울기도 항상 크다.",
            "기울기는 X가 1단위 변할 때 Y의 변화량을 나타낸다.",
            "상관계수는 데이터 점들이 직선 주위에 얼마나 밀집해 있는지를 나타낸다."
        ],
        "hint": "기울기는 X가 1단위 변할 때 Y의 변화량이며, 상관계수는 두 변수의 선형적 관계를 나타냅니다. 둘 사이에는 직접적 관계가 없습니다.",
        "solution": [
            "기울기는 X가 1단위 변할 때 Y의 변화량을 나타낸다.",
            "상관계수는 데이터 점들이 직선 주위에 얼마나 밀집해 있는지를 나타낸다."
        ],
    },
    {
        "item_type": "radio",
        "question": "공분산(Covariance)과 피어슨 상관계수에 대한 설명으로 가장 적절한 것은 무엇입니까?",
        "options": [
            "공분산은 단위의 영향을 받지 않아 해석이 용이하다.",
            "피어슨 상관계수는 공분산과 달리 항상 0보다 큰 값을 가진다.",
            "피어슨 상관계수는 공분산을 각 변수의 표준편차 곱으로 나누어 표준화한 값이다.",
            "공분산과 피어슨 상관계수 모두 비선형 관계를 측정하는 데 주로 사용된다."
        ],
        "hint": "공분산은 단위에 따라 값이 달라지기 때문에, 피어슨 상관계수는 이를 표준화한 값입니다.",
        "solution": "피어슨 상관계수는 공분산을 각 변수의 표준편차 곱으로 나누어 표준화한 값이다.",
    },
    {
        "item_type": "checkbox",
        "question": "상관분석의 가설검정 결과, p-value가 0.03 (유의수준 α = 0.05)이고, 95% 신뢰구간이 [0.15, 0.65]로 나왔을 때, 올바른 해석을 **모두** 고르세요.",
        "options": [
            "p-value < α 이다",
            "p-value > α 이다",
            "귀무가설을 채택한다",
            "귀무가설을 기각한다",
            "두 변수 간 유의한 선형 관계가 없다.",
            "두 변수 간 유의한 선형 관계가 있다.",
            "신뢰구간에 0이 포함되므로 두 변수 간 관계의 방향을 명확히 알 수 없다.",
            "신뢰구간이 음수(-)에서 양수(+)를 포함하므로 통계적으로 유의하지 않다.",
            "신뢰구간이 음수(-)에 걸쳐 있으므로 두 변수 간 음의 선형 관계가 있다.",
            "신뢰구간이 양수(+)에 걸쳐 있으므로 두 변수 간 양의 선형 관계가 있다."
        ],
        "hint": "0.03은 0.05보다 작으므로 귀무가설을 기각합니다. 신뢰구간이 양수 구간에 있으므로 두 변수 간 양의 선형 관계가 있습니다.",
        "solution": [
            "p-value < α 이다",
            "귀무가설을 기각한다",
            "두 변수 간 유의한 선형 관계가 있다.",
            "신뢰구간이 양수(+)에 걸쳐 있으므로 두 변수 간 양의 선형 관계가 있다."
        ],
    },
    {
        "item_type": "number",
        "question": "주가 데이터 price.xlsx에서 S&P 500 지수의 변화율(sp500_change)과 금 가격의 변화율(gold_change)의 피어슨 상관계수를 구하세요. (소수점 셋째 자리까지)",
        "options": [],
        "hint": "```\nimport pandas as pd\npr = pd.read_excel(\'price.xlsx\')\npg.corr(pr[\'sp500_change\'], pr[\'gold_change\'])\n```\n\n실행 결과에서 r이 상관계수입니다",
        "tolerance": 0.001,
        "solution": 0.026435
    },
    {
        "item_type": "number",
        "question": "위의 상관분석의 p-value는 얼마입니까? (소수점 셋째 자리까지)",
        "options": [],
        "hint": "```\nimport pandas as pd\npr = pd.read_excel(\'price.xlsx\')\npg.corr(pr[\'sp500_change\'], pr[\'gold_change\'])\n```\n\n실행 결과에서 p-val이 p-value입니다",
        "tolerance": 0.001,
        "solution": 0.598094
    },
    {
        "item_type": "radio",
        "question": "유의수준 5%에서 위의 분석 결과를 해석하세요",
        "options": [
            "S&P500 지수와 금 가격의 변화율 사이에 통계적으로 유의한 양의 상관관계가 있다",
            "S&P500 지수와 금 가격의 변화율 사이에 통계적으로 유의한 음의 상관관계가 있다",
            "S&P500 지수와 금 가격의 변화율 사이에 통계적으로 유의한 상관관계가 없다"
        ],
        "hint": "p > 유의수준이므로 귀무가설을 기각하지 못합니다. 즉, 두 변수 간 통계적으로 유의한 상관관계가 없다고 판단합니다.",
        "solution": "S&P500 지수와 금 가격의 변화율 사이에 통계적으로 유의한 상관관계가 없다"
    }
]
} />


## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>

