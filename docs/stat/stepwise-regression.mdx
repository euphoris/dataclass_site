# 단계적 회귀분석

## 단계적 회귀분석 (Stepwise Regression)

- 독립변수의 후보가 k개 있으면 가능한 독립변수의 조합은 $2^k$개
- 독립변수의 후보가 많으면 모든 조합으로 회귀분석을 실시하는 것은 현실적으로 불가능
- 단계적 회귀분석(stepwise regression): 독립변수를 하나씩 추가/제거 하여 종속변수를 잘 예측하는 변수들을 선택하는 기법
- 예측력이 (통계적으로) 유의한 예측변수들만을 골라줌
- 오직 자료만으로 변수를 선택하기 때문에 이상한 결과가 생길 수 있음
- 단계적 회귀분석은 탐색적으로 주요 변수를 파악하는 목적으로만 실시해야


## 전진 선택 (Forward Selection)

- 독립변수를 하나씩 추가
- 예) A, B, C, D를 가지고 Y를 예측하는 전진 방식의 단계적 회귀분석을 한다면,
    - A, B, C, D 중 설명력이 제일 큰 예측변수? A
    - A+B, A+C, A+D 중에 설명력이 가장 큰 조합은? A+B
    - A와 A+B의 설명력이 유의하게 차이가 나지 않으면 중단
    - 설명력이 유의하게 차이가 나면 A+B+C, A+B+D 중에 설명력이 가장 큰 조합을 찾음
    - 이상의 과정을 계속

[💾 varsel.py 다운로드](https://drive.google.com/file/d/1qSg1QlJKErsROH3w7-ueS0MbYxWCL3eq/view?usp=drive_link)

```python
import varsel
m = varsel.forward_selection(
    'price ~ year + mileage + model + my_car_damage + other_car_damage', df)
m.summary()
```

## 후진 선택 (Backward Selection)

- 독립변수를 하나씩 제거
- 예) A, B, C, D를 가지고 Y를 예측하는 후진 방식의 단계적 회귀분석을 한다면,
    - A+B+C+D에서 설명력이 가장 적게 줄어드는 변수를 제거 (D라고 하자)
    - A+B+C와 A+B+C+D 설명력이 유의하게 차이가 나면 중단
    - 차이가 나지 않으면 A+B+C에서 설명이 가장 적게 줄어드는 변수를 제거
    - 이상의 과정을 반복

```python
m = varsel.backward_selection(
    'price ~ year + mileage + model + my_car_damage + other_car_damage', df)
m.summary()
```

## 단계적 회귀분석 주의점

- 변수를 순서대로 선택하기 때문에 검토하지 못하는 조합이 생김
    - A -> A+B -> A+B+C ... 순으로 탐색을 하면 B+C는 검토할 기회가 없음
- 전진 방식과 후진 방식의 결과가 항상 같은 건 아님
    - 대체로 전진 방식이 후진 방식보다 적은 변수를 선택하는 경향이 있음


## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="stepwise-regression" quizItems={
[
    {
        "item_type": "radio",
        "question": "단계적 회귀분석(Stepwise Regression)의 주요 목적은 무엇인가요?",
        "options": [
            "모든 독립변수를 반드시 포함하는 가장 설명력 높은 모형을 찾는 것",
            "독립변수 간의 비선형 관계를 자동으로 찾아 모형에 반영하는 것",
            "여러 독립변수 후보 중에서 통계적으로 유의미하거나 예측력을 높이는 변수들을 자동으로 선택하는 것",
            "회귀계수의 해석을 용이하게 하기 위해 모든 변수를 표준화하는 것"
        ],
        "hint": "단계적 회귀분석은 독립변수 후보 중에서 예측력을 높이는 변수들을 선택하는 기법입니다.",
        "solution": "여러 독립변수 후보 중에서 통계적으로 유의미하거나 예측력을 높이는 변수들을 자동으로 선택하는 것",
    },
    {
        "item_type": "radio",
        "question": "독립변수를 포함하지 않은 상태에서 시작하여, 모형의 성능을 가장 크게 향상시키는 변수를 하나씩 추가해 나가는 방식의 단계적 회귀분석은 무엇인가요?",
        "options": [
            "전진 선택 (Forward Selection)",
            "후진 선택 (Backward Selection)",
            "양방향 선택 (Bidirectional Selection)",
            "최소제곱 선택 (Least Squares Selection)"
        ],
        "hint": "전진 선택은 독립변수를 하나씩 추가하는 방식입니다.",
        "solution": "전진 선택 (Forward Selection)",
    },
    {
        "item_type": "radio",
        "question": "모든 독립변수를 포함한 상태에서 시작하여, 모형의 성능 저하가 가장 적은 변수를 하나씩 제거해 나가는 방식의 단계적 회귀분석은 무엇인가요?",
        "options": [
            "전진 선택 (Forward Selection)",
            "후진 선택 (Backward Selection)",
            "양방향 선택 (Bidirectional Selection)",
            "최소제곱 선택 (Least Squares Selection)"
        ],
        "hint": "후진 선택은 독립변수를 하나씩 제거하는 방식입니다.",
        "solution": "후진 선택 (Backward Selection)",
    },
    {
        "item_type": "checkbox",
        "question": "cement.xlsx 에서 y는 시멘트가 굳을 때 발생하는 열을 나타냅니다. 이것을 종속변수로 회귀분석을 해보세요. x1, x2, x3, x4는 시멘트의 특정 성분의 비율을 나타냅니다. 전진 선택을 통해 단계적 회귀분석을 했을 때 최종적으로 선택된 모형에 포함된 독립변수를 고르세요",
        "options": [
            'x1',
            'x2',
            'x3',
            'x4',
        ],
        "hint": "```\nimport pandas as pd\nimport varsel\nce = pd.read_excel(\'cement.xlsx\')\nm = varsel.forward_selection(\'y ~ x1 + x2 + x3 + x4\', ce)\nm.summary()\n```",
        "solution": [
            'x1',
            'x2',
            'x4',
        ],
    },
    {
        "item_type": "number",
        "question": "위 분석 결과의 수정 R제곱은? (소수점 셋째 자리까지)",
        "tolerance": 0.001,
        "hint": "최종 결과에서 Adj. R-squared",
        "solution": 0.976
    },
    {
        "item_type": "number",
        "question": "위 분석 결과의 AIC는? (소수점 둘째 자리까지)",
        "tolerance": 0.01,
        "hint": "최종 결과에서 AIC",
        "solution": 61.87

    },
    {
        "item_type": "number",
        "question": "위 분석 결과의 BIC는? (소수점 둘째 자리까지)",
        "hint": "최종 결과에서 BIC",
        "tolerance": 0.01,
        "solution": 64.13
    },
    {
        "item_type": "radio",
        "question": "cement.xlsx 에서 y는 시멘트가 굳을 때 발생하는 열을 나타냅니다. 이것을 종속변수로 회귀분석을 해보세요. x1, x2, x3, x4는 시멘트의 특정 성분의 비율을 나타냅니다. 후진 선택을 통해 단계적 회귀분석을 했을 때 제일 먼저 제외된 독립변수들을  고르세요.",
        "options": [
            'x1',
            'x2',
            'x3',
            'x4',
        ],
        "hint": "```\nimport pandas as pd\nimport varsel\nce = pd.read_excel(\'cement.xlsx\')\nm = varsel.backward_selection(\'y ~ x1 + x2 + x3 + x4\', ce)\nm.summary()\n```",
        "solution": 'x3'
    }
]} />

## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>