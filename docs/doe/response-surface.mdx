# 반응 표면 설계

- 소수의 요인이 공정 성능을 좌우할 때, 최적화를 목표로 실험할 수 있음
- 최적화를 위해서는 요인과 반응 간의 곡면성(curvature)을 모델링하는 것이 유용
- 곡면성을 모델링하는 가장 간단한 방법은 2차 효과(quadratic effects)를 사용하는 것
- 이를 위해 각 연속형 요인은 최소 3수준을 가져야
- 표준 반응 표면 설계는 연속형 요인에만 적용되지만, 실제로는 범주형 요인도 중요한 경우가 많음.

## 예시: 포장 공정
- 핵심 품질 특성:
    - 너무 낮은 박리 강도: 포장이 새어 제품의 신선도가 떨어짐
    - 너무 높은 박리 강도: 소비자가 포장을 열기 어려워 불만을 야기
    - 박리 강도를 특정 목표치(target value)인 4.5 파운드에 정확히 맞추는 것이 중요
- 강건성(robustness) 문제:
    - 이 회사는 3개의 다른 공급 업체로부터 포장재를 납품받음
    - 공급 업체마다 포장재의 미세한 특성 차이가 있어, 동일한 공정 조건에서도 박리 강도가 달라지는 문제가 발생
    - 단일 공정 조건으로 모든 공급 업체의 원자재에 대해 일관된 품질을 내는 것이 목표

### 실험 요인
-  연속형 공정 요인
    - 온도(Temperature): 193–230 °C
    - 압력(Pressure): 2.2–3.2 bar
    - 속도(Speed): 32–50 cpm
- 범주형 방해 요인
    - 공급 업체(Supplier): 3수준 (품질에 영향을 미치지만 제어할 수 없음)

## D-최적 설계 vs. I-최적 설계


- D-최적 설계 (D-optimal design):
    - 모수 추정 오차를 최소화(정보량 최대화)
    - 스크리닝 실험 설계에 적합
- I-최적 설계 (I-optimal design):
    - 모델의 예측 오차를 최소화
    - 반응 표면 설계 선택에 적합함.

## 설계 영역 (design regions)
- 실험이 가능한 요인 수준 조합의 집합
- 실험 영역(experimental region) 또는 설계 공간(design space)이라고도 함
- 일반적으로 직육면체(cuboidal)나 구(spherical) 형태를 가정
- 모든 요인이 [-1, +1] 범위의 값을 자유롭게 가진다면 직육면체 형태
- 이때 설계 영역의 부피는 2^𝑘 (k: 요인의 개수)
- 실제로는 제약 조건으로 인해 불규칙한 형태를 가질 수 있음
- 최적 설계는 이러한 제약 조건을 반영할 수 있어야 함

## 중심 합성 설계 (Central Composite Design, CCD)
- 중심 합성 설계는 2차 모델(quadratic model)을 효율적으로 추정하기 위해 가장 널리 사용되는 반응 표면 설계
- 실험점의 종류:
    - 요인점 (Factorial Points): 완전 요인 설계나 부분 요인 설계의 실험점들
        - 요인 간의 1차 효과(main effects)와 교호작용(interactions)을 추정
    - 축점 (Axial or Star Points): 각 요인의 축을 따라 설계 중심으로부터 거리 𝛼만큼 떨어진 점
        - 곡면성을 나타내는 2차 항을 추정
    - 중심점 (Center Points): 모든 요인이 중간 수준(0)에 있는 점들
        -   실험의 순수 오차(pure error)를 추정하고 공정의 안정성을 확인하는 데 도움
- 특징:
    - 5-수준 설계: 각 연속형 요인은 -α, -1, 0, 1, +α의 5개 수준
    - 회전성 (Rotatability): 축점의 위치 𝛼를 적절히 조절하면, 설계 중심으로부터 같은 거리에 있는 모든 지점에서 예측의 정밀도(분산)가 동일하게 되는 회전 가능한 설계를 만들 수 있음
    - 설계 공간 내에서 어느 방향으로 탐색하더라도 예측의 신뢰도가 동일함을 의미
    - 순차적 실험: 2^𝑘 요인 설계 실험을 먼저 수행한 후, 곡면성의 존재가 의심될 때 축점과 중심점을 추가하여 중심 합성 설계로 확장할 수 있음

```python
import pyDOE3 as doe
doe.ccdesign(2, center=(3, 3), alpha='r')
# 2개의 연속형 요인에 대한 중심 합성 설계 생성
# center=(3, 3) -> 요인점 3회, 축점 3회 중심점 반복(보통 3~5회 반복)
```

## 박스-벤켄 설계 (Box-Behnken Design, BBD)

- 박스-벤켄 설계는 중심 합성 설계의 대안으로 사용되는 효율적인 반응 표면 설계
- 설계 공간의 꼭짓점(corner)을 포함하지 않는 것이 특징
- 실험점들은 각 요인 축 쌍으로 이루어진 부분 공간의 중심과 전체 설계 공간의 중심에 위치
- 예: 3요인 설계의 경우 (±1, ±1, 0), (±1, 0, ±1), (0, ±1, ±1)과 같은 조합으로 실험점이 구성
- 특징:
    - 3-수준 설계: 각 요인은 -1, 0, 1의 3개 수준만으로 구성되어 CCD보다 실험 조건 설정이 용이
    - 극단적인 실험 조건 회피: 모든 요인이 동시에 최고(예: [1, 1, 1]) 또는 최저 수준에 있는 실험점(예: [-1, -1, -1])을 포함하지 않음
    - 공정 비용이 높거나, 위험하여 극단적인 조건의 실험이 불가능할 때 유용한 장점
    - 효율성: 일반적으로 요인 수가 3-5개일 때, CCD보다 적은 실험 횟수로 2차 모델을 만들 수 있음
    - 비회전성: 설계 공간의 방향에 따라 정밀도가 다름
    - 꼭짓점 부근 예측 품질 저하

```python
doe.bbdesign(3, center=3) # 중심점 3회 반복
```

## 퀴즈

<iframe src="https://tally.so/embed/mJ4DkX?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" loading="lazy" width="100%" height="1619" frameborder="0" marginheight="0" marginwidth="0" title="[DOE] 반응 표면 설계"></iframe>