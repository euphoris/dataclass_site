
# 요인배치법



## 요인 배치법과 교호작용

  * 실제 공정에서는 여러 요인이 동시에 결과에 영향 (예: 열처리 온도와 시간)
  * 요인 배치법 (Factorial Design)
      * 두 개 이상의 요인을 동시에 변화시키며 실험하는 설계 방법
      * 각 요인의 주 효과(Main Effect)는 물론, 요인들이 결합되었을 때 나타나는 교호작용(Interaction) 효과까지 파악할 수 있음



## 직교성 (Orthogonality)의 원리

  - 직교성이란 각 요인의 효과를 서로 독립적으로, 섞임 없이(confounding) 추정할 수 있는 설계의 성질
      - 실험 계획 행렬에서 어떤 두 열(요인)을 골라 곱한 값의 합이 0이 되면, 두 요인은 직교
  - 주요 특징:
    - 독립적 추정: 서로 다른 요인의 효과를 독립적으로 추정(분석에 요인을 추가하거나 제거하더라도 나머지 요인의 추정된 계수가 변하지 않음)
    - 비상관 요인: 설계 행렬의 열은 서로 상관 관계가 없음(다중 공선성 최소화)
    - 효율성: 주 효과를 추정하는 데 필요한 실행 횟수 측면에서 일반적으로 효율적임



## 완전 요인 배치법 (Full Factorial Design)

  * 관심 있는 모든 요인들의 모든 수준 조합을 전부 실험하는 방법
      * $2^k$ 요인 설계: `k`개의 요인을 각각 2개의 수준(e.g., 낮음/높음)으로 실험하는 설계 
  * 예시: $2^2$ 설계 (2요인 2수준)
      * 온도(-1, 1)와 압력(-1, 1)이 미치는 영향을 보기 위해 가능한 4가지 조합을 모두 실험
        1.  온도 낮음, 압력 낮음
        2.  온도 높음, 압력 낮음
        3.  온도 낮음, 압력 높음
        4.  온도 높음, 압력 높음
  * 장점과 단점
      * 장점: 모든 주 효과와 모든 교호작용을 명확하게 분석할 수 있음
      * 단점: 요인 수가 증가하면 실험 횟수가 기하급수적으로 폭발합



## 실습 준비

- 설치
```python
!pip install pyDOE3
```

- 임포트
```python
import pyDOE3 as doe
```



## 완전 요인 배치법 실습

- 요인별로 여러 수준이 있는 경우
```python
LEVELS = [2, 3]  # 첫번째 요인은 2 수준, 두번째 요인은 3 수준
doe.fullfact(LEVELS)
```


- 2수준 완전 요인 배치법
  - 요인별로 낮음/높음 2 수준만 실험
```python
doe.ff2n(3)
```



## 부분 요인 배치법 (Fractional Factorial Design)

  * 완전 요인 배치법의 실험 횟수가 너무 많을 때, 실험의 일부만 수행하여 자원과 시간을 절약하는 방법
  * 부분 요인 배치법($2^{k-p}$): 
    * 요인이 5개일 경우 완전 요인 배치법: $2^5=32$회 실험
    * 절반($p=1$)인 16회($2^{5-1}$)
    * 1/4($p=2$)인 8회($2^{5-2}$)만 실험
  * 어떻게 가능한가?: 효과의 희소성 원리
      * 효과의 희소성(Sparsity of Effects) 원리에 따르면, 대부분의 공정 결과는 소수의 주 효과와 낮은 차수의 교호작용(e.g., 2-요인 교호작용)에 의해 지배됩니다.
      * 3-요인 이상의 고차 교호작용은 대부분 무시할 수 있을 만큼 작습니다.



## 교락

- 교락(Confounding): 실험 횟수를 줄이는 과정에서, 두 개 이상의 효과(예: 주 효과와 교호작용)가 서로 섞여서 통계적으로 분리하여 추정할 수 없게 되는 현상
- 부분 요인 배치법은 완전 요인 설계에서 의도적으로 일부 실험 조합을 생략하기 때문에 교락 발생
-   Alias Structure: 어떤 효과가 다른 어떤 효과와 섞여 있는지를 나타내는 관계
  - 예시: $2^{3-1}$ 설계 (4회 실험)
      -   요인 C를 교호작용 AB와 동일하게 설정 (C = AB)
      -   이때 A = BC, B = AC의 교락 관계가 형성
          -   C는 AB와 교락 (C = AB)
- 효과의 희소성 원리에 따라, 2차 이상의 고차 교호작용(BC, AC, AB 등)은 그 영향이 거의 없거나 무시할 수 있을 정도로 작다고 가정하에 진행
  - 위 가정이 맞지 않으면 분석에 오류



## 부분 요인 배치법 실습

  - 시나리오: 5개의 2수준 요인(A, B, C, D, E)이 제품 수율에 미치는 영향을 파악하고자 함
      - 완전 요인 설계 시 $2^5 = 32$회의 실험 필요
      - 시간과 비용 절감을 위해 실험 횟수를 절반(16회)으로 줄이는 부분 요인 배치법($2^{5-1}$) 적용 결정
  - pyDOE3를 이용한 설계 생성:
      - 이 설계에서는 5번째 요인(E)이 A, B, C, D의 교호작용(ABCD)과 동일하게 설정됨 (E = ABCD)
      - 4차 교호작용은 드물기 때문에 어느 정도 안전한 가정
```python
doe.fracfact("a b c d abcd")
```

- $2^{(5-1)}$ 부분요인 배치법에서 최적의 설계 찾기
```python
design, alias_map, alias_cost = doe.fracfact_opt(5, 1)
design
```

## 퀴즈

<iframe src="https://tally.so/embed/31av2b?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" loading="lazy" width="100%" height="1500" frameborder="0" marginheight="0" marginwidth="0" title="[DOE] 요인배치법"></iframe>