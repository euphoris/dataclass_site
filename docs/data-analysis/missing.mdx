# 결측치 처리

## 결측치 Missing Values
* 데이터셋에서 누락된 값 또는 값이 기록되지 않은 경우
* 원인
    * 데이터 수집 오류: 데이터 입력 실수, 기기 오작동이나 데이터 전송 오류
    * 의도적 미응답: 설문 등에서 민감한 질문이나 답변하기 까다로운 질문
    * 데이터 손실: 데이터베이스 손상, 파일 손실, 시스템 충돌, 네트워크 문제
    * 불완전한 데이터 소스: 데이터가 일부만 제공되거나 누락된 경우

## 결측치의 종류
* MCAR (Missing Completely at Random)
    * 결측치가 완전히 무작위로 발생하며, 다른 변수들과 상관관계가 없음
    * 예: 설문 조사에서 무작위로 몇 명이 응답하지 않은 경우
    * 큰 문제 안되지만 MCAR은 드묾
* MAR (Missing at Random)
    * 결측치가 다른 관측 가능한 변수와 관련이 있지만, 해당 변수와는 무관
    * 예: 남성 응답자들이 특정 질문에 응답하지 않은 경우, 그러나 성별은 관찰됨
    * 어느 정도 대응 가능하며, 일반적으로 결측치에 대해 MAR을 가정하고 대응
* MNAR (Missing Not at Random)
    * 결측치가 해당 변수와 관련이 있으며, 무작위로 발생하지 않음
    * 예: 소득이 낮은 사람들이 소득 질문에 응답하지 않는 경우
    * 대응이 까다로움

## 결측치 대응 방법
* 삭제 (Deletion): 결측치가 있는 데이터를 삭제하고 분석
* 대체 (Imputation): 결측치를 다른 값으로 대체함
* 모형 기반 접근: 결측치에 영향을 받지 않는 모형을 사용
* 결측치 자체를 하나의 특징으로 사용: 특수한 경우에 사용

## 삭제의 방법
* 리스트와이즈 삭제 (Listwise Deletion)
    * 결측치가 있는 전체 행을 삭제
    * 간단하고 구현이 용이하지만, 많은 데이터 손실
    * MCAR일 때만 유효.
* 페어와이즈 삭제 (Pairwise Deletion)
    * 분석에 필요한 변수에만 결측치가 있는 행을 삭제
    * 데이터 손실 최소화
    * 각각의 분석이 서로 다른 부분집합에 대해 이뤄지기 때문에, 결과 일관성에 문제가 생길 수 있음
        * 예: 상관행렬이 양의 정부호(positive definite)가 아닐 수 있음

## 결측치 보기
* 실습 데이터 열기
```python
import pandas as pd
df = pd.read_excel('car') # 원본 데이터
dm = pd.read_excel('car_miss.xlsx') # 결측치 있는 데이터
```
* 결측치 있는 행 보기
```python
dm.query('mileage.isnull()')
```
* 결측치 없는 행 보기
```python
dm.query('mileage.notnull()')
```

## 결측치 삭제
* 결측치가 하나라도 있는 '행' 제거
```python
dm.dropna()
```
* 결측치가 하나라도 있는 '열' 제거
```python
dm.dropna(axis=1)
```
* `how='all'`: 모든 값이 결측치인 행/열만 제거
```python
dm.dropna(how='all')
```
* `subset=['컬럼명']`: 특정 컬럼에 결측치가 있는 경우에만 행 제거
```python
df.dropna(subset=['price', 'mileage'])
```

## 평균
* 원 데이터의 평균
```python
df['mileage'].mean()
```
* 결측치가 있는 데이터의 평균
```python
dm['mileage'].mean()
```
* 기본적으로 결측치는 삭제하고 평균냄(`skipna=True`)
```python
dm['mileage'].mean(skipna=False)
```

## 표준편차
* 원 데이터의 표준편차
```python
df['mileage'].std()
```
* 결측치가 있는 데이터의 표준편차
```python
dm['mileage'].std()
```

## 분포 시각화
```python
import seaborn as sns
import matplotlib.pyplot as plt
sns.kdeplot(df['mileage'], label='original')
sns.kdeplot(dm['mileage'], label='missing')
plt.legend()
```

## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="missing" quizItems={
[
    {
        "item_type": "radio",
        "question": "데이터셋에서 값이 누락되거나 기록되지 않은 경우를 무엇이라고 합니까?",
        "options": [
            "이상치 (Outlier)",
            "결측치 (Missing Value)",
            "오류치 (Error Value)",
            "극단치 (Extreme Value)"
        ],
        "hint": "교안의 제목이기도 하며, 데이터 수집 오류나 의도적 미응답 등으로 발생할 수 있습니다.",
        "solution": "결측치 (Missing Value)"
    },
    {
        "item_type": "radio",
        "question": "결측치의 종류 중, '소득이 낮은 사람이 소득 질문에 응답하지 않는 경우'와 같이 결측치가 해당 변수 자체와 관련이 있어 대응하기 가장 까다로운 유형은 무엇입니까?",
        "options": [
            "MCAR (Missing Completely at Random)",
            "MAR (Missing at Random)",
            "MNAR (Missing Not at Random)",
            "MAAR (Missing Always at Random)"
        ],
        "hint": "결측이 무작위가 아니라는(Not at Random) 의미를 가집니다.",
        "solution": "MNAR (Missing Not at Random)"
    },
    {
        "item_type": "radio",
        "question": "결측치가 있는 행 전체를 삭제하는 가장 간단한 결측치 처리 방법을 무엇이라고 합니까?",
        "options": [
            "리스트와이즈 삭제 (Listwise Deletion)",
            "페어와이즈 삭제 (Pairwise Deletion)",
            "평균 대체 (Mean Imputation)",
            "모형 기반 접근 (Model-based Approach)"
        ],
        "hint": "구현은 간단하지만 많은 데이터 손실을 유발할 수 있는 방법입니다.",
        "solution": "리스트와이즈 삭제 (Listwise Deletion)"
    },
    {
        "item_type": "short",
        "question": "pandas DataFrame `dm`의 'mileage' 열에 결측치가 있는 행만 필터링하려고 합니다. `dm.query('mileage.____()')`의 빈칸에 들어갈 메소드는 무엇입니까?",
        "hint": "'null(결측치)인가?'라는 의미를 가진 메소드입니다.",
        "solution": "isnull"
    },
    {
        "item_type": "radio",
        "question": "pandas DataFrame `dm`에서 결측치가 하나라도 포함된 '열(column)'을 제거하기 위한 올바른 코드는 무엇입니까?",
        "options": [
            "dm.dropna()",
            "dm.dropna(axis=0)",
            "dm.dropna(axis=1)",
            "dm.dropna(how='all')"
        ],
        "hint": "`axis=1` 옵션은 열을 기준으로 작업을 수행하도록 지정합니다.",
        "solution": "dm.dropna(axis=1)"
    },
    {
        "item_type": "radio",
        "question": "`dm.dropna(subset=['price', 'mileage'])` 코드는 어떤 동작을 수행합니까?",
        "options": [
            "'price'와 'mileage' 열 자체를 삭제합니다.",
            "'price' 또는 'mileage' 열에 결측치가 있는 행을 삭제합니다.",
            "'price'와 'mileage' 열을 제외한 모든 열에서 결측치를 찾습니다.",
            "모든 값이 결측치인 행만 삭제합니다."
        ],
        "hint": "`subset` 옵션은 검사할 대상을 특정 열로 한정하는 역할을 합니다.",
        "solution": "'price' 또는 'mileage' 열에 결측치가 있는 행을 삭제합니다."
    },
    {
        "item_type": "radio",
        "question": "pandas에서 `dm['mileage'].mean()`과 같이 평균을 계산할 때, 기본적으로 결측치를 어떻게 처리합니까?",
        "options": [
            "결측치를 0으로 간주하고 계산",
            "결측치가 있으면 오류 발생",
            "결측치를 제외(무시)하고 계산",
            "결측치를 평균값으로 대체한 후 계산"
        ],
        "hint": "함수의 `skipna` 파라미터의 기본값이 `True`인 것을 생각해보세요.",
        "solution": "결측치를 제외(무시)하고 계산"
    }
]
} />


## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>