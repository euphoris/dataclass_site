
# 결측치 대체의 방법

## 대체의 방법
* 평균/중앙값 또는 최빈값으로 대체
    * 장점: 간단하고 빠름
    * 단점: 데이터 변동성 감소, 편향 발생 가능
* 예측 대체
    * 회귀 모형이나 KNN을 사용하여 결측치를 예측하여 대체
    * 장점: 보다 정확한 대체
    * 단점: 데이터 변동성 감소
* 다중 대체 (Multiple Imputation)
    * 결측치를 여러 번 대체하고, 여러 대체 결과를 결합하여 불확실성을 반영
    * 장점: 불확실성 반영, 보다 정확한 대체.
    * 단점: 복잡도 증가, 계산 비용 증가.

## 채우기
* 결측치를 0으로 채우기
```python
dm.fillna(0)
```
* 'mileage' 컬럼의 결측치만 0으로 채우기
```python
dm['mileage'].fillna(0)
```
* 앞/뒤 값으로 채우기: 시계열 데이터(주식, 날씨 등)에서 유용
```python
dm.fillna(method='ffill') # 바로 앞의 유효한 값으로 채움
dm.fillna(method='bfill') # 바로 뒤의 유효한 값으로 채움
```

## 평균으로 대체
* 평균으로 대체
```python
m = dm['mileage'].mean()
impute_mean = dm['mileage'].fillna(m)
impute_mean.mean()
impute_mean.std()
```
* 분포 시각화
```python
sns.kdeplot(df['mileage'], label='original')
sns.kdeplot(impute_mean, label='mean')
plt.legend()
```

## 예측 대체
* 2개의 유사사례로 예측 (KNN, K=2)
```python
from sklearn.impute import KNNImputer
imputer = KNNImputer(n_neighbors=2, weights="uniform")
X = imputer.fit_transform(dm[['mileage', 'price', 'year']])
impute_knn = X[:, 0]
impute_knn.mean()
impute_knn.std()
```
* 분포 시각화
```python
sns.kdeplot(dm['mileage'], label='original')
sns.kdeplot(impute_knn, label='knn')
plt.legend()
```

## 다중 대체
```python
import numpy as np
from sklearn.experimental import enable_iterative_imputer
from sklearn.impute import IterativeImputer
from sklearn.neighbors import KNeighborsRegressor
imputer = IterativeImputer(sample_posterior=True, random_state=42)
X1 = imputer.fit_transform(dm[['mileage', 'price', 'year']]) # 첫번째 대체
X2 = imputer.fit_transform(dm[['mileage', 'price', 'year']]) # 두번째 대체
X = np.concatenate([X1, X2], axis=0) # 두번의 대체 결과 합치기
```
* 분포 시각화
```python
sns.kdeplot(dm['mileage'], label='original')
sns.kdeplot(X1[:, 0], label='imputation 1')
sns.kdeplot(X2[:, 0], label='imputation 2')
sns.kdeplot(X[:, 0], label='combined')
plt.legend()
```

## inplace
* `dropna()`, `fillna()` 등 많은 pandas 메소드는 원본 데이터를 변경하지 않음
* 처리된 결과를 새로운 변수에 저장
```python
df_filled = dm.fillna(0)
```
* 원본을 직접 수정
```python
dm.fillna(0, inplace=True)
```

## 퀴즈

import { QuizComponent } from "@/components/QuizComponent";

<QuizComponent quizId="imputation" quizItems={
[
    {
        "item_type": "radio",
        "question": "다음 중 결측치 대체 방법 중 가장 간단하고 빠르지만, 데이터의 변동성을 감소시키고 편향을 발생시킬 수 있는 방법은 무엇입니까?",
        "options": [
            "평균/중앙값 대체",
            "예측 대체 (Predictive Imputation)",
            "다중 대체 (Multiple Imputation)",
            "결측치 삭제 (Deletion)"
        ],
        "hint": "데이터의 통계량을 이용하는 가장 기본적인 대체 방법입니다.",
        "solution": "평균/중앙값 대체"
    },
    {
        "item_type": "short",
        "question": "pandas에서 결측치를 특정 값으로 채우기 위해 사용하는 메소드의 이름은 무엇입니까?",
        "hint": "'채우다'를 의미하는 'fill'과 결측치를 의미하는 'na'가 합쳐진 형태입니다.",
        "solution": "fillna"
    },
    {
        "item_type": "radio",
        "question": "주식 가격이나 날씨와 같은 시계열 데이터에서, 결측치를 바로 '앞'의 유효한 값으로 채우고 싶을 때 `fillna()` 메소드에 사용해야 할 인자는 무엇입니까?",
        "options": [
            "method='ffill'",
            "method='bfill'",
            "method='mean'",
            "method='nearest'"
        ],
        "hint": "'forward fill'의 약자입니다.",
        "solution": "method='ffill'"
    },
    {
        "item_type": "radio",
        "question": "DataFrame `dm`의 'mileage' 열의 결측치를 해당 열의 평균값 `m`으로 대체하는 올바른 코드는 무엇입니까?",
        "options": [
            "dm['mileage'].fillna(m)",
            "dm.fillna('mileage', m)",
            "dm['mileage'].replace(None, m)",
            "dm.impute('mileage', m)"
        ],
        "hint": "`fillna()` 메소드에 대체할 값을 직접 인자로 전달합니다.",
        "solution": "dm['mileage'].fillna(m)"
    },
    {
        "item_type": "radio",
        "question": "다른 변수와의 관계를 이용해 회귀 모형이나 KNN 같은 알고리즘으로 결측치를 예측하여 채우는 방법을 무엇이라고 합니까?",
        "options": [
            "단순 대체",
            "예측 대체",
            "다중 대체",
            "확률적 대체"
        ],
        "hint": "교안에서 `sklearn.impute.KNNImputer`를 사용한 예시가 이 방법에 해당합니다.",
        "solution": "예측 대체"
    },
    {
        "item_type": "radio",
        "question": "결측치를 한 번만 채우는 것이 아니라, 여러 번의 대체를 통해 여러 개의 데이터셋을 만들고 그 결과를 결합하여 결측의 불확실성을 반영하는 고급 기법은 무엇입니까?",
        "options": [
            "평균 대체",
            "예측 대체",
            "다중 대체",
            "최빈값 대체"
        ],
        "hint": "'Multiple Imputation'을 번역한 용어입니다.",
        "solution": "다중 대체"
    },
    {
        "item_type": "radio",
        "question": "`dm.fillna(0, inplace=True)` 코드에서 `inplace=True` 인자의 역할로 올바른 설명은 무엇입니까?",
        "options": [
            "결과를 새로운 변수에 저장하라는 의미이다.",
            "결측치가 있을 경우에만 작업을 수행하라는 의미이다.",
            "원본 DataFrame(`dm`)을 직접 수정하라는 의미이다.",
            "작업을 미리보기만 하고 실제 적용은 하지 말라는 의미이다."
        ],
        "hint": "이 옵션을 사용하지 않으면, 메소드는 원본을 바꾸지 않고 변경된 결과를 반환만 합니다.",
        "solution": "원본 DataFrame(`dm`)을 직접 수정하라는 의미이다."
    }
]
} />


## Q&A
<iframe src="https://tally.so/embed/wbOOKg?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=0" loading="lazy" width="100%" height="274" frameborder="0" marginheight="0" marginwidth="0" title="Q&A"></iframe>